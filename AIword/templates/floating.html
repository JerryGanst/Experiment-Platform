<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIword - 智能提示词补全</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/floating.css') }}" rel="stylesheet">
    <style>
        /* 防止选择和拖拽 */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-app-region: no-drag;
        }
        
        /* 允许输入框选择文本 */
        #questionInput {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* 头部可拖拽 */
        .header {
            -webkit-app-region: drag;
            cursor: move;
        }
        
        .header * {
            -webkit-app-region: no-drag;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 可拖拽头部 -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>AIword</h1>
            </div>
            <div class="subtitle">智能提示词补全</div>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 输入区域 -->
            <div class="input-section">
                <div class="input-wrapper">
                    <div class="search-container">
                        <div class="input-group">
                            <textarea 
                                id="questionInput" 
                                class="search-input" 
                                placeholder="输入你的问题，AI将智能补全..."
                                rows="3"
                                spellcheck="false"
                            ></textarea>
                            <div class="keyboard-tooltip">
                                Tab触发补全 | ↑↓选择 | Enter确认
                            </div>
                            <button id="submitBtn" class="submit-btn">
                                <i class="fas fa-paper-plane"></i>
                                提交问题
                            </button>
                        </div>
                        <div class="input-meta">
                            <span class="char-count">字符: <span id="charCount">0</span></span>
                            <span class="input-hint">Tab激活补全</span>
                        </div>
                    </div>
                    
                    <!-- 智能补全浮层 -->
                    <div id="completionLayer" class="completion-layer hidden">
                        <div class="completion-header">
                            <i class="fas fa-lightbulb"></i>
                            <span>智能建议</span>
                            <button id="closeCompletion" class="close-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="completionOptions" class="completion-options">
                            <!-- 动态生成补全选项 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 热门提示词 -->
            <div class="popular-section">
                <h3><i class="fas fa-fire"></i> 热门提示</h3>
                <div id="popularCompletions" class="popular-tags">
                    <!-- 动态加载 -->
                </div>
            </div>

            <!-- 专业领域 -->
            <div class="categories-section">
                <h3><i class="fas fa-th-large"></i> 专业领域</h3>
                <div id="categoriesGrid" class="categories-grid">
                    <!-- 动态加载 -->
                </div>
            </div>

            <!-- 使用统计 -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">问题</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="completionRate">0%</div>
                        <div class="stat-label">成功率</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="avgResponseTime">0ms</div>
                        <div class="stat-label">响应</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 底部信息 -->
        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2024 AIword | 智能补全助手</p>
                <div class="footer-links">
                    <a href="#" onclick="showHelp()">帮助</a>
                    <a href="#" onclick="showSettings()">设置</a>
                    <a href="#" onclick="showAbout()">关于</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>设置</h3>
                <button class="close-modal" onclick="hideModal('settingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>触发延迟（毫秒）</label>
                    <input type="number" id="triggerDelay" value="300" min="100" max="2000">
                </div>
                <div class="setting-group">
                    <label>最大建议数</label>
                    <input type="number" id="maxSuggestions" value="6" min="3" max="10">
                </div>
                <div class="setting-group">
                    <label>自动补全</label>
                    <input type="checkbox" id="autoComplete" checked>
                </div>
                <div class="setting-group">
                    <label>窗口透明度</label>
                    <input type="range" id="windowOpacity" min="30" max="100" value="95" step="5">
                </div>
                <div class="setting-group">
                    <label>始终置顶</label>
                    <input type="checkbox" id="alwaysOnTop" checked>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveSettings()" class="btn btn-primary">保存</button>
                <button onclick="hideModal('settingsModal')" class="btn btn-secondary">取消</button>
            </div>
        </div>
    </div>

    <!-- 通知提示 -->
    <div id="notification" class="notification hidden">
        <div class="notification-content">
            <i id="notificationIcon" class="fas fa-check-circle"></i>
            <span id="notificationText">操作成功</span>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // 悬浮窗特定功能
        document.addEventListener('DOMContentLoaded', function() {
            // 阻止默认拖拽行为
            document.addEventListener('dragstart', e => e.preventDefault());
            
            // 右键菜单
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showContextMenu(e.clientX, e.clientY);
            });
            
            // 快捷键支持
            document.addEventListener('keydown', function(e) {
                // Ctrl+Shift+H 切换隐藏/显示
                if (e.ctrlKey && e.shiftKey && e.key === 'H') {
                    e.preventDefault();
                    toggleWindowVisibility();
                }
                
                // Ctrl+Shift+T 切换置顶
                if (e.ctrlKey && e.shiftKey && e.key === 'T') {
                    e.preventDefault();
                    toggleAlwaysOnTop();
                }
                
                // Escape 最小化窗口
                if (e.key === 'Escape' && !document.querySelector('.modal:not(.hidden)')) {
                    minimizeWindow();
                }
            });
        });
        
        function showContextMenu(x, y) {
            // 创建右键菜单
            const menu = document.createElement('div');
            menu.className = 'context-menu';
            menu.style.cssText = `
                position: fixed;
                top: ${y}px;
                left: ${x}px;
                background: white;
                border: 1px solid #ccc;
                border-radius: 4px;
                padding: 4px 0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 10000;
                font-size: 12px;
            `;
            
            const menuItems = [
                { text: '设置', action: () => showSettings() },
                { text: '置顶切换', action: () => toggleAlwaysOnTop() },
                { text: '重新加载', action: () => location.reload() },
                { text: '关于', action: () => showAbout() }
            ];
            
            menuItems.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.textContent = item.text;
                menuItem.style.cssText = `
                    padding: 4px 12px;
                    cursor: pointer;
                    hover:background: #f0f0f0;
                `;
                menuItem.onclick = () => {
                    item.action();
                    document.body.removeChild(menu);
                };
                menu.appendChild(menuItem);
            });
            
            document.body.appendChild(menu);
            
            // 点击其他地方关闭菜单
            setTimeout(() => {
                document.addEventListener('click', function closeMenu() {
                    if (document.body.contains(menu)) {
                        document.body.removeChild(menu);
                    }
                    document.removeEventListener('click', closeMenu);
                }, 100);
            });
        }
        
        function toggleWindowVisibility() {
            // 通过webview API控制窗口（如果可用）
            if (window.pywebview) {
                window.pywebview.api.toggle_window();
            }
        }
        
        function toggleAlwaysOnTop() {
            if (window.pywebview) {
                window.pywebview.api.toggle_always_on_top();
            }
        }
        
        function minimizeWindow() {
            if (window.pywebview) {
                window.pywebview.api.minimize_window();
            }
        }
    </script>
</body>
</html> 