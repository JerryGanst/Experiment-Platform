2025-06-08 14:39:46,118 - __main__ - INFO - Starting CAKE experiment suite with run name: cake_run_20250608_143946
2025-06-08 14:39:46,119 - __main__ - INFO - Arguments: Namespace(model_name='microsoft/DialoGPT-large', datasets='narrativeqa', kv_cache_lengths='2048', batch_sizes='1', max_new_tokens=256, allocation_strategies='adaptive', cache_budgets='0.2', repetitions=1, output_dir='gqa_results/microsoft_DialoGPT-large/narrativeqa_ctx2048_bud0.2', log_level='INFO', seed=42, run_name='cake_run_20250608_143946')
2025-06-08 14:39:46,119 - __main__ - INFO - Global EXPERIMENT_CONFIG being used: {'model_name_or_path': 'NousResearch/Llama-2-7b-hf', 'precision': 'fp16', 'datasets': ['mmlu', 'gsm8k', 'winogrande', 'arc_challenge', 'hellaswag', 'truthful_qa_mc'], 'dataset_subset_size': {'mmlu': 100, 'gsm8k': 100, 'winogrande': None, 'arc_challenge': None, 'hellaswag': None, 'truthful_qa_mc': None, 'pubmed_qa': 100, 'cais/mmlu-zh': 50}, 'kv_cache_lengths': [512, 1024, 2048], 'batch_sizes': [1, 4, 8], 'max_new_tokens': 256, 'repetitions': 3, 'h2o_enabled': True, 'h2o_ratios': [0.1, 0.2, 0.3], 'eviction_strategies': ['attention', 'time_decay', 'hybrid'], 'h2o_kv_cache_lengths': [512, 1024], 'cake_enabled': True, 'layer_allocation_strategies': ['uniform', 'adaptive', 'attention_based'], 'layer_analysis_configs': {'attention_pattern_analysis': True, 'layer_importance_scoring': True, 'dynamic_allocation': True}, 'cache_budgets': [0.5, 0.7, 0.9], 'cake_kv_cache_lengths': [512, 1024], 'head_level_optimization': False, 'head_analysis_enabled': False, 'head_selection_strategy': 'top_k', 'head_k_value': 10, 'output_base_dir': 'results', 'enable_monitoring': True, 'monitor_interval': 0.5}
2025-06-08 14:39:46,119 - __main__ - INFO - Global CAKE_MODEL_CONFIG being used: {'default_allocation_strategy': 'adaptive', 'default_cache_budget': 0.8, 'supported_models_cake': ['llama', 'mistral', 'qwen2'], 'dynamic_allocation_default': True, 'layer_analysis_default': {'attention_pattern_analysis': True, 'layer_importance_scoring': True}}
2025-06-08 14:39:46,133 - __main__ - INFO - Random seed set to 42
2025-06-08 14:39:46,133 - __main__ - INFO - Total number of CAKE experiment configurations to run: 1
2025-06-08 14:39:46,134 - __main__ - INFO - Running CAKE: Rep 1/1, Dataset: narrativeqa, KV_Len: 2048, Batch: 1, Strategy: adaptive, Budget: 0.2
2025-06-08 14:39:46,135 - __main__ - INFO - Starting CAKE experiment: cake_narrativeqa_kv2048_bs1_stratadaptive_bud0.2_rep0_20250608_143946
2025-06-08 14:39:46,135 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-08 14:39:46,135 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: cake_narrativeqa_kv2048_bs1_stratadaptive_bud0.2_rep0_20250608_143946
2025-06-08 14:39:46,135 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-08 14:39:46,135 - __main__ - INFO - Loading model and tokenizer...
2025-06-08 14:39:46,135 - hace_core.models.model_loader - INFO - Loading model: microsoft/DialoGPT-large
2025-06-08 14:39:47,521 - hace_core.models.model_loader - ERROR - Error loading model: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /microsoft/DialoGPT-large/resolve/main/model.safetensors (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: 3e912d51-fee6-46a6-b740-c230301267a5)')
2025-06-08 14:39:47,521 - __main__ - ERROR - Error during CAKE experiment cake_narrativeqa_kv2048_bs1_stratadaptive_bud0.2_rep0_20250608_143946: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /microsoft/DialoGPT-large/resolve/main/model.safetensors (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: 3e912d51-fee6-46a6-b740-c230301267a5)')
urllib3.exceptions.SSLError: [SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\urllib3\connectionpool.py", line 843, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /microsoft/DialoGPT-large/resolve/main/model.safetensors (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\baselines\cake_main.py", line 145, in run_cake_experiment
    model, tokenizer = load_model_and_tokenizer(current_model_config)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\hace_core\models\model_loader.py", line 31, in load_model_and_tokenizer
    model = AutoModelForCausalLM.from_pretrained(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\transformers\models\auto\auto_factory.py", line 571, in from_pretrained
    return model_class.from_pretrained(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\transformers\modeling_utils.py", line 282, in _wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\transformers\modeling_utils.py", line 4329, in from_pretrained
    checkpoint_files, sharded_metadata = _get_resolved_checkpoint_files(
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\transformers\modeling_utils.py", line 1044, in _get_resolved_checkpoint_files
    if not has_file(pretrained_model_name_or_path, safe_weights_name, **has_file_kwargs):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\transformers\utils\hub.py", line 670, in has_file
    response = get_session().head(
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 624, in head
    return self.request("HEAD", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\utils\_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\adapters.py", line 698, in send
    raise SSLError(e, request=request)
requests.exceptions.SSLError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /microsoft/DialoGPT-large/resolve/main/model.safetensors (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: 3e912d51-fee6-46a6-b740-c230301267a5)')
2025-06-08 14:39:47,525 - hace_core.utils.unified_monitor - ERROR - 实验标记为失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /microsoft/DialoGPT-large/resolve/main/model.safetensors (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: 3e912d51-fee6-46a6-b740-c230301267a5)')
2025-06-08 14:39:47,525 - __main__ - INFO - Cleaned up resources for experiment cake_narrativeqa_kv2048_bs1_stratadaptive_bud0.2_rep0_20250608_143946
2025-06-08 14:39:47,527 - __main__ - INFO - All CAKE experiment summaries saved to gqa_results/microsoft_DialoGPT-large/narrativeqa_ctx2048_bud0.2\cake_run_20250608_143946\all_cake_experiments_summary.csv
2025-06-08 14:39:47,527 - __main__ - INFO - CAKE experiment suite finished.
