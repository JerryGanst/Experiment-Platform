2025-06-17 16:33:01,657 - __main__ - INFO - Starting FullKVCache experiment suite with run name: fullkvcache_run_20250617_163301
2025-06-17 16:33:01,658 - __main__ - INFO - Arguments: Namespace(model_name='C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', datasets='hotpotqa', kv_cache_lengths='128,256,512,1024,2048', batch_sizes='1,4,8', max_new_tokens=50, repetitions=3, output_dir='results\\fullkvcache_experiments', log_level='INFO', seed=42, run_name='fullkvcache_run_20250617_163301', enable_scoring=True, is_baseline_run=True)
2025-06-17 16:33:01,658 - __main__ - INFO - Global EXPERIMENT_CONFIG being used: {'model_name_or_path': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'multi_model_experiments': True, 'experiment_models': ['NousResearch/Llama-2-7b-hf', 'meta-llama/Meta-Llama-3.1-8B-Instruct', 'mistralai/Mistral-7B-Instruct-v0.3'], 'memory_management': {'auto_max_memory': True, 'manual_max_memory': {0: '23000MB'}, 'memory_buffer_ratio': 0.05, 'force_no_cpu_offload': True}, 'datasets': ['mmlu', 'gsm8k', 'winogrande', 'arc_challenge', 'hellaswag', 'truthful_qa_mc'], 'dataset_subset_size': {'mmlu': 100, 'gsm8k': 100, 'winogrande': None, 'arc_challenge': None, 'hellaswag': None, 'truthful_qa_mc': None, 'pubmed_qa': 100, 'cais/mmlu-zh': 50}, 'kv_cache_lengths': [128, 256, 512, 1024, 2048], 'batch_sizes': [1, 4, 8], 'max_new_tokens': 256, 'repetitions': 3, 'h2o_enabled': True, 'h2o_ratios': [0.1, 0.2, 0.3], 'eviction_strategies': ['attention', 'time_decay', 'hybrid'], 'h2o_kv_cache_lengths': [128, 256, 512, 1024, 2048], 'cake_enabled': True, 'layer_allocation_strategies': ['uniform', 'adaptive', 'attention_based'], 'layer_analysis_configs': {'attention_pattern_analysis': True, 'layer_importance_scoring': True, 'dynamic_allocation': True}, 'cache_budgets': [0.5, 0.7, 0.9], 'cake_kv_cache_lengths': [128, 256, 512, 1024, 2048], 'head_level_optimization': False, 'head_analysis_enabled': False, 'head_selection_strategy': 'top_k', 'head_k_value': 10, 'output_base_dir': 'results', 'enable_monitoring': True, 'monitor_interval': 0.5}
2025-06-17 16:33:01,681 - __main__ - INFO - Random seed set to 42
2025-06-17 16:33:01,681 - __main__ - INFO - Total number of FullKVCache experiment configurations to run: 45
2025-06-17 16:33:01,681 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 128, Batch: 1
2025-06-17 16:33:01,834 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301
2025-06-17 16:33:01,882 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:33:01,882 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:33:01,883 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301
2025-06-17 16:33:01,883 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:33:01,883 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:33:01,883 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:33:01,883 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:33:01,883 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:33:06,527 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:33:06,527 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:33:06,528 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.59GB, 已保留 9.69GB
2025-06-17 16:33:06,849 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:33:06,849 - __main__ - INFO - 模型加载后GPU内存: 10.30GB
2025-06-17 16:33:06,849 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 16:33:06,850 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:33:06,850 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 16:33:06,850 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:33:06,850 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:33:06,850 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:33:07,039 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:33:07,039 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:33:10,954 - __main__ - INFO - Preparing batch with size 1, max_length 128...
2025-06-17 16:33:11,003 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:33:11,004 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:33:21,351 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:33:21,351 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:33:21,352 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:33:21,352 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:33:21,352 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:33:23,350 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:34:33,615 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 72.26秒
2025-06-17 16:34:33,615 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:34:33,616 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:34:33,616 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10366.8MB
2025-06-17 16:34:33,741 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9968.1MB, 样本=641
2025-06-17 16:34:33,741 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 16:34:33,741 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9968.1MB, 样本=641
2025-06-17 16:34:33,741 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 16:34:33,742 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs1_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301.json
2025-06-17 16:34:33,743 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301', 'timestamp': '2025-06-17T16:34:33.741050', 'performance': {'success': True, 'ttft_ms': 1998.0230331420898, 'tpot_ms': 1433.9789468414929, 'throughput_tokens_per_sec': 0.6919171073834992, 'total_time_sec': 72.26299142837524, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10366.75341796875, 'average_memory_mb': 9968.135611928383, 'sample_count': 641}, 'total_peak_memory_mb': 10366.75341796875}, 'system': {'peak_cpu_percent': 18.5, 'average_cpu_percent': 8.493055555555555, 'peak_memory_percent': 45.6, 'peak_memory_used_gb': 29.1285400390625, 'sample_count': 72}, 'monitoring_duration': 72.38967204093933}
2025-06-17 16:34:33,743 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301 的资源...
2025-06-17 16:34:34,167 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs1_rep0_20250617_163301 资源清理完成
2025-06-17 16:34:34,175 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs1_rep0
2025-06-17 16:34:34,365 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 128, Batch: 4
2025-06-17 16:34:34,518 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434
2025-06-17 16:34:34,590 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:34:34,590 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:34:34,590 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434
2025-06-17 16:34:34,591 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:34:34,591 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:34:34,665 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:34:34,665 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:34:34,665 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:34:37,839 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:34:37,840 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:34:37,840 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:34:38,063 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:34:38,064 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:34:38,064 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 16:34:38,064 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:34:38,064 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 16:34:38,064 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:34:38,064 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:34:38,064 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:34:38,247 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:34:38,247 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:34:40,963 - __main__ - INFO - Preparing batch with size 4, max_length 128...
2025-06-17 16:34:40,975 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:34:40,975 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:34:54,363 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:34:54,363 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:34:54,364 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:34:54,364 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:34:54,364 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:34:56,212 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:36:06,909 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 72.54秒
2025-06-17 16:36:06,910 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:36:06,910 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:36:06,910 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10435.2MB
2025-06-17 16:36:06,959 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10044.6MB, 样本=643
2025-06-17 16:36:06,959 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 16:36:06,959 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10044.6MB, 样本=643
2025-06-17 16:36:06,959 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 16:36:06,960 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs4_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434.json
2025-06-17 16:36:06,960 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434', 'timestamp': '2025-06-17T16:36:06.959846', 'performance': {'success': True, 'ttft_ms': 1847.2602367401123, 'tpot_ms': 1442.8031055294737, 'throughput_tokens_per_sec': 0.6892310585245297, 'total_time_sec': 72.54461240768433, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10435.15380859375, 'average_memory_mb': 10044.563363414902, 'sample_count': 643}, 'total_peak_memory_mb': 10435.15380859375}, 'system': {'peak_cpu_percent': 19.6, 'average_cpu_percent': 9.127777777777778, 'peak_memory_percent': 46.7, 'peak_memory_used_gb': 29.825199127197266, 'sample_count': 72}, 'monitoring_duration': 72.5959165096283}
2025-06-17 16:36:06,960 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434 的资源...
2025-06-17 16:36:07,411 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs4_rep0_20250617_163434 资源清理完成
2025-06-17 16:36:07,418 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs4_rep0
2025-06-17 16:36:07,497 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 128, Batch: 8
2025-06-17 16:36:07,643 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs8_rep0_20250617_163607
2025-06-17 16:36:07,715 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:36:07,715 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:36:07,715 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs8_rep0_20250617_163607
2025-06-17 16:36:07,715 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:36:07,715 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:36:07,788 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:36:07,788 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:36:07,788 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:36:10,961 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:36:10,961 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:36:10,962 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:36:11,191 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:36:11,191 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:36:11,191 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 16:36:11,191 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:36:11,191 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 16:36:11,192 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:36:11,192 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:36:11,192 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:36:11,371 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:36:11,371 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:36:13,545 - __main__ - ERROR - Error during FullKVCache experiment fullkvcache_hotpotqa_kv128_bs8_rep0_20250617_163607: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/datasets/THUDM/LongBench/revision/a8b3fea296d0126b1887abb5ad2004d9184344fc (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: c6224b55-e86e-4bbc-9d4a-447bd96547d0)')
urllib3.exceptions.SSLError: [SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\adapters.py", line 667, in send
    resp = conn.urlopen(
           ^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\urllib3\connectionpool.py", line 843, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\urllib3\util\retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/datasets/THUDM/LongBench/revision/a8b3fea296d0126b1887abb5ad2004d9184344fc (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\baselines\fullkvcache_main.py", line 545, in run_fullkvcache_experiment
    longbench_raw = load_longbench_official_data(dataset_name, actual_num_samples_to_prepare)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\baselines\fullkvcache_main.py", line 144, in load_longbench_official_data
    dataset = load_dataset("THUDM/LongBench", dataset_name, split="test")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\load.py", line 2062, in load_dataset
    builder_instance = load_dataset_builder(
                       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\load.py", line 1819, in load_dataset_builder
    builder_instance: DatasetBuilder = builder_cls(
                                       ^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\builder.py", line 343, in __init__
    self.config, self.config_id = self._create_builder_config(
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\builder.py", line 598, in _create_builder_config
    builder_config._resolve_data_files(
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\builder.py", line 207, in _resolve_data_files
    self.data_files = self.data_files.resolve(base_path, download_config)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\data_files.py", line 788, in resolve
    out[key] = data_files_patterns_list.resolve(base_path, download_config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\data_files.py", line 751, in resolve
    origin_metadata = _get_origin_metadata(data_files, download_config=download_config)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\data_files.py", line 506, in _get_origin_metadata
    return thread_map(
           ^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\tqdm\contrib\concurrent.py", line 69, in thread_map
    return _executor_map(ThreadPoolExecutor, fn, *iterables, **tqdm_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\tqdm\contrib\concurrent.py", line 51, in _executor_map
    return list(tqdm_class(ex.map(fn, *iterables, chunksize=chunksize), **kwargs))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\tqdm\std.py", line 1169, in __iter__
    for obj in iterable:
  File "C:\Users\JerryGanst\anaconda3\Lib\concurrent\futures\_base.py", line 619, in result_iterator
    yield _result_or_cancel(fs.pop())
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\concurrent\futures\_base.py", line 317, in _result_or_cancel
    return fut.result(timeout)
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\concurrent\futures\_base.py", line 456, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\concurrent\futures\_base.py", line 401, in __get_result
    raise self._exception
  File "C:\Users\JerryGanst\anaconda3\Lib\concurrent\futures\thread.py", line 58, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\datasets\data_files.py", line 485, in _get_single_origin_metadata
    resolved_path = fs.resolve_path(data_file)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\hf_file_system.py", line 198, in resolve_path
    repo_and_revision_exist, err = self._repo_and_revision_exist(repo_type, repo_id, revision)
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\hf_file_system.py", line 125, in _repo_and_revision_exist
    self._api.repo_info(
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\utils\_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\hf_api.py", line 2807, in repo_info
    return method(
           ^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\utils\_validators.py", line 114, in _inner_fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\hf_api.py", line 2664, in dataset_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\huggingface_hub\utils\_http.py", line 96, in send
    return super().send(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\JerryGanst\anaconda3\Lib\site-packages\requests\adapters.py", line 698, in send
    raise SSLError(e, request=request)
requests.exceptions.SSLError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/datasets/THUDM/LongBench/revision/a8b3fea296d0126b1887abb5ad2004d9184344fc (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: c6224b55-e86e-4bbc-9d4a-447bd96547d0)')
2025-06-17 16:36:13,554 - hace_core.utils.unified_monitor - ERROR - 实验标记为失败: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/datasets/THUDM/LongBench/revision/a8b3fea296d0126b1887abb5ad2004d9184344fc (Caused by SSLError(SSLEOFError(8, '[SSL: UNEXPECTED_EOF_WHILE_READING] EOF occurred in violation of protocol (_ssl.c:1000)')))"), '(Request ID: c6224b55-e86e-4bbc-9d4a-447bd96547d0)')
2025-06-17 16:36:13,554 - hace_core.utils.unified_monitor - WARNING - 设备 0 没有收集到GPU内存数据
2025-06-17 16:36:13,554 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 0.0MB
2025-06-17 16:36:13,555 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs8_rep0_20250617_163607 的资源...
2025-06-17 16:36:14,058 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs8_rep0_20250617_163607 资源清理完成
2025-06-17 16:36:14,063 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs8_rep0
2025-06-17 16:36:14,139 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 256, Batch: 1
2025-06-17 16:36:14,393 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614
2025-06-17 16:36:14,468 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:36:14,469 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:36:14,469 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614
2025-06-17 16:36:14,469 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:36:14,469 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:36:14,543 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:36:14,543 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:36:14,543 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:36:17,763 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:36:17,764 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:36:17,764 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:36:17,985 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:36:17,985 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:36:17,985 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 16:36:17,985 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:36:17,985 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 16:36:17,985 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:36:17,985 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:36:17,985 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:36:18,167 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:36:18,167 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:36:20,494 - __main__ - INFO - Preparing batch with size 1, max_length 256...
2025-06-17 16:36:20,496 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:36:20,496 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:36:31,493 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:36:31,493 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:36:31,493 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:36:31,493 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:36:31,494 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:36:34,076 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:37:42,874 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 71.38秒
2025-06-17 16:37:42,874 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:37:42,874 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:37:42,874 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10382.8MB
2025-06-17 16:37:42,899 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9982.2MB, 样本=632
2025-06-17 16:37:42,899 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 16:37:42,899 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9982.2MB, 样本=632
2025-06-17 16:37:42,899 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 16:37:42,900 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs1_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614.json
2025-06-17 16:37:42,900 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614', 'timestamp': '2025-06-17T16:37:42.899111', 'performance': {'success': True, 'ttft_ms': 2582.611083984375, 'tpot_ms': 1404.0080771154287, 'throughput_tokens_per_sec': 0.70047629470101, 'total_time_sec': 71.38000297546387, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10382.75830078125, 'average_memory_mb': 9982.219897306419, 'sample_count': 632}, 'total_peak_memory_mb': 10382.75830078125}, 'system': {'peak_cpu_percent': 23.0, 'average_cpu_percent': 9.161971830985914, 'peak_memory_percent': 46.6, 'peak_memory_used_gb': 29.759506225585938, 'sample_count': 71}, 'monitoring_duration': 71.40604162216187}
2025-06-17 16:37:42,900 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614 的资源...
2025-06-17 16:37:43,345 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs1_rep0_20250617_163614 资源清理完成
2025-06-17 16:37:43,351 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs1_rep0
2025-06-17 16:37:43,429 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 256, Batch: 4
2025-06-17 16:37:43,577 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743
2025-06-17 16:37:43,647 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:37:43,647 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:37:43,647 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743
2025-06-17 16:37:43,647 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:37:43,647 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:37:43,721 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:37:43,721 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:37:43,721 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:37:46,788 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:37:46,789 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:37:46,789 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:37:47,012 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:37:47,012 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:37:47,012 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 16:37:47,012 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:37:47,012 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 16:37:47,012 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:37:47,012 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:37:47,012 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:37:47,195 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:37:47,195 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:37:49,678 - __main__ - INFO - Preparing batch with size 4, max_length 256...
2025-06-17 16:37:49,681 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:37:49,682 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:38:02,595 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:38:02,595 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:38:02,595 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:38:02,595 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:38:02,596 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:38:05,501 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:39:14,456 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 71.86秒
2025-06-17 16:39:14,456 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:39:14,456 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:39:14,457 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10499.4MB
2025-06-17 16:39:14,494 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10090.3MB, 样本=637
2025-06-17 16:39:14,494 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 16:39:14,494 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10090.3MB, 样本=637
2025-06-17 16:39:14,494 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 16:39:14,495 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs4_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743.json
2025-06-17 16:39:14,495 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743', 'timestamp': '2025-06-17T16:39:14.494450', 'performance': {'success': True, 'ttft_ms': 2905.651807785034, 'tpot_ms': 1407.220324691461, 'throughput_tokens_per_sec': 0.6957930840512732, 'total_time_sec': 71.86044406890869, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10499.43896484375, 'average_memory_mb': 10090.271145567602, 'sample_count': 637}, 'total_peak_memory_mb': 10499.43896484375}, 'system': {'peak_cpu_percent': 22.8, 'average_cpu_percent': 9.647887323943662, 'peak_memory_percent': 47.0, 'peak_memory_used_gb': 29.974838256835938, 'sample_count': 71}, 'monitoring_duration': 71.89931511878967}
2025-06-17 16:39:14,496 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743 的资源...
2025-06-17 16:39:14,957 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs4_rep0_20250617_163743 资源清理完成
2025-06-17 16:39:14,962 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs4_rep0
2025-06-17 16:39:15,034 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 256, Batch: 8
2025-06-17 16:39:15,183 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915
2025-06-17 16:39:15,253 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:39:15,254 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:39:15,254 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915
2025-06-17 16:39:15,254 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:39:15,254 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:39:15,346 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:39:15,346 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:39:15,346 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:39:18,445 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:39:18,445 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:39:18,445 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:39:18,667 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:39:18,667 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:39:18,667 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 16:39:18,668 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:39:18,668 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 16:39:18,668 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:39:18,668 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:39:18,668 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:39:18,847 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:39:18,847 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:39:21,273 - __main__ - INFO - Preparing batch with size 8, max_length 256...
2025-06-17 16:39:21,276 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:39:21,276 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:39:37,822 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:39:37,822 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:39:37,822 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:39:37,822 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:39:37,823 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:39:41,308 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:40:58,113 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 80.29秒
2025-06-17 16:40:58,113 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:40:58,113 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:40:58,114 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10658.1MB
2025-06-17 16:40:58,121 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10237.0MB, 样本=712
2025-06-17 16:40:58,121 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 16:40:58,121 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10237.0MB, 样本=712
2025-06-17 16:40:58,121 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 16:40:58,123 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs8_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915.json
2025-06-17 16:40:58,123 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915', 'timestamp': '2025-06-17T16:40:58.121230', 'performance': {'success': True, 'ttft_ms': 3485.1160049438477, 'tpot_ms': 1567.4238788838288, 'throughput_tokens_per_sec': 0.6227434664877255, 'total_time_sec': 80.28988289833069, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10658.13720703125, 'average_memory_mb': 10237.03194470352, 'sample_count': 712}, 'total_peak_memory_mb': 10658.13720703125}, 'system': {'peak_cpu_percent': 28.5, 'average_cpu_percent': 9.575949367088608, 'peak_memory_percent': 45.6, 'peak_memory_used_gb': 29.074867248535156, 'sample_count': 79}, 'monitoring_duration': 80.29885363578796}
2025-06-17 16:40:58,123 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915 的资源...
2025-06-17 16:40:58,540 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs8_rep0_20250617_163915 资源清理完成
2025-06-17 16:40:58,545 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs8_rep0
2025-06-17 16:40:58,618 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 512, Batch: 1
2025-06-17 16:40:58,765 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058
2025-06-17 16:40:58,837 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:40:58,837 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:40:58,837 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058
2025-06-17 16:40:58,837 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:40:58,837 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:40:58,907 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:40:58,907 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:40:58,907 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:41:02,202 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:41:02,202 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:41:02,202 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:41:02,424 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:41:02,424 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:41:02,424 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 16:41:02,424 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:41:02,424 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 16:41:02,424 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:41:02,424 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:41:02,424 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:41:02,600 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:41:02,600 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:41:09,461 - __main__ - INFO - Preparing batch with size 1, max_length 512...
2025-06-17 16:41:09,463 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:41:09,463 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:41:22,179 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:41:22,179 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:41:22,179 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:41:22,179 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:41:22,180 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:41:23,707 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:42:32,927 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 70.75秒
2025-06-17 16:42:32,927 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:42:32,927 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:42:32,928 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10432.5MB
2025-06-17 16:42:32,968 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10030.5MB, 样本=624
2025-06-17 16:42:32,968 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 16:42:32,968 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10030.5MB, 样本=624
2025-06-17 16:42:32,968 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 16:42:32,969 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs1_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058.json
2025-06-17 16:42:32,969 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058', 'timestamp': '2025-06-17T16:42:32.968624', 'performance': {'success': True, 'ttft_ms': 1527.237892150879, 'tpot_ms': 1412.633214678083, 'throughput_tokens_per_sec': 0.7067411315404218, 'total_time_sec': 70.7472620010376, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10432.52001953125, 'average_memory_mb': 10030.4957807492, 'sample_count': 624}, 'total_peak_memory_mb': 10432.52001953125}, 'system': {'peak_cpu_percent': 100.0, 'average_cpu_percent': 13.677142857142854, 'peak_memory_percent': 44.5, 'peak_memory_used_gb': 28.37818145751953, 'sample_count': 70}, 'monitoring_duration': 70.78915238380432}
2025-06-17 16:42:32,969 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058 的资源...
2025-06-17 16:42:33,368 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs1_rep0_20250617_164058 资源清理完成
2025-06-17 16:42:33,391 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs1_rep0
2025-06-17 16:42:33,480 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 512, Batch: 4
2025-06-17 16:42:33,628 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233
2025-06-17 16:42:33,702 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:42:33,702 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:42:33,702 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233
2025-06-17 16:42:33,702 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:42:33,702 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:42:33,776 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:42:33,776 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:42:33,776 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:42:36,859 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:42:36,859 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:42:36,859 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:42:37,079 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:42:37,079 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:42:37,080 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 16:42:37,080 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:42:37,080 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 16:42:37,080 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:42:37,080 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:42:37,080 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:42:37,258 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:42:37,258 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:42:39,982 - __main__ - INFO - Preparing batch with size 4, max_length 512...
2025-06-17 16:42:39,984 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:42:39,984 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:42:56,416 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:42:56,416 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:42:56,417 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:42:56,417 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:42:56,417 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:42:58,759 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:44:08,996 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 72.58秒
2025-06-17 16:44:08,997 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:44:08,997 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:44:08,997 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10633.1MB
2025-06-17 16:44:09,009 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10222.4MB, 样本=643
2025-06-17 16:44:09,009 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 16:44:09,009 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10222.4MB, 样本=643
2025-06-17 16:44:09,009 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 16:44:09,010 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs4_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233.json
2025-06-17 16:44:09,011 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233', 'timestamp': '2025-06-17T16:44:09.009612', 'performance': {'success': True, 'ttft_ms': 2342.0464992523193, 'tpot_ms': 1433.4116176683076, 'throughput_tokens_per_sec': 0.688902456068036, 'total_time_sec': 72.57921576499939, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10633.11865234375, 'average_memory_mb': 10222.369821029355, 'sample_count': 643}, 'total_peak_memory_mb': 10633.11865234375}, 'system': {'peak_cpu_percent': 26.7, 'average_cpu_percent': 9.281944444444443, 'peak_memory_percent': 45.8, 'peak_memory_used_gb': 29.222118377685547, 'sample_count': 72}, 'monitoring_duration': 72.59316897392273}
2025-06-17 16:44:09,011 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233 的资源...
2025-06-17 16:44:09,454 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs4_rep0_20250617_164233 资源清理完成
2025-06-17 16:44:09,459 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs4_rep0
2025-06-17 16:44:09,533 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 512, Batch: 8
2025-06-17 16:44:09,679 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409
2025-06-17 16:44:09,751 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:44:09,752 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:44:09,752 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409
2025-06-17 16:44:09,752 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:44:09,752 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:44:09,824 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:44:09,824 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:44:09,824 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:44:12,937 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:44:12,938 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:44:12,938 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:44:13,159 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:44:13,160 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:44:13,160 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 16:44:13,160 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:44:13,160 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 16:44:13,160 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:44:13,160 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:44:13,160 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:44:13,339 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:44:13,339 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:44:15,885 - __main__ - INFO - Preparing batch with size 8, max_length 512...
2025-06-17 16:44:15,888 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:44:15,888 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:44:39,166 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:44:39,166 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:44:39,167 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:44:39,167 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:44:39,167 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:44:42,253 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:45:56,937 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 77.77秒
2025-06-17 16:45:56,937 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:45:56,937 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:45:56,938 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10909.5MB
2025-06-17 16:45:56,962 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10491.0MB, 样本=689
2025-06-17 16:45:56,962 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 16:45:56,962 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10491.0MB, 样本=689
2025-06-17 16:45:56,962 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 16:45:56,963 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs8_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409.json
2025-06-17 16:45:56,963 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409', 'timestamp': '2025-06-17T16:45:56.962098', 'performance': {'success': True, 'ttft_ms': 3085.5164527893066, 'tpot_ms': 1524.1404942103795, 'throughput_tokens_per_sec': 0.6429264159056254, 'total_time_sec': 77.76939749717712, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10909.52783203125, 'average_memory_mb': 10490.994038574927, 'sample_count': 689}, 'total_peak_memory_mb': 10909.52783203125}, 'system': {'peak_cpu_percent': 27.0, 'average_cpu_percent': 10.6012987012987, 'peak_memory_percent': 46.7, 'peak_memory_used_gb': 29.80438232421875, 'sample_count': 77}, 'monitoring_duration': 77.79513835906982}
2025-06-17 16:45:56,963 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409 的资源...
2025-06-17 16:45:57,397 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs8_rep0_20250617_164409 资源清理完成
2025-06-17 16:45:57,403 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs8_rep0
2025-06-17 16:45:57,477 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 1
2025-06-17 16:45:57,625 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557
2025-06-17 16:45:57,697 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:45:57,697 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:45:57,697 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557
2025-06-17 16:45:57,697 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:45:57,698 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:45:57,768 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:45:57,769 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:45:57,769 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:46:00,897 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:46:00,898 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:46:00,898 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:46:01,120 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:46:01,120 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:46:01,120 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 16:46:01,120 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:46:01,121 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 16:46:01,121 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:46:01,121 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:46:01,121 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:46:01,300 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:46:01,301 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:46:05,049 - __main__ - INFO - Preparing batch with size 1, max_length 1024...
2025-06-17 16:46:05,054 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:46:05,054 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:46:18,281 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:46:18,281 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:46:18,281 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:46:18,281 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:46:18,282 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:46:21,396 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:47:27,605 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 69.32秒
2025-06-17 16:47:27,605 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:47:27,605 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:47:27,605 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10480.5MB
2025-06-17 16:47:27,651 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10075.4MB, 样本=614
2025-06-17 16:47:27,651 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 16:47:27,651 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10075.4MB, 样本=614
2025-06-17 16:47:27,652 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 16:47:27,653 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs1_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557.json
2025-06-17 16:47:27,653 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557', 'timestamp': '2025-06-17T16:47:27.651795', 'performance': {'success': True, 'ttft_ms': 3114.4840717315674, 'tpot_ms': 1351.1794635227748, 'throughput_tokens_per_sec': 0.7212584871603644, 'total_time_sec': 69.32327437400818, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10480.5341796875, 'average_memory_mb': 10075.381519429458, 'sample_count': 614}, 'total_peak_memory_mb': 10480.5341796875}, 'system': {'peak_cpu_percent': 42.6, 'average_cpu_percent': 8.665217391304349, 'peak_memory_percent': 45.9, 'peak_memory_used_gb': 29.298248291015625, 'sample_count': 69}, 'monitoring_duration': 69.37076115608215}
2025-06-17 16:47:27,653 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557 的资源...
2025-06-17 16:47:28,008 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs1_rep0_20250617_164557 资源清理完成
2025-06-17 16:47:28,013 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs1_rep0
2025-06-17 16:47:28,084 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 4
2025-06-17 16:47:28,229 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728
2025-06-17 16:47:28,305 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:47:28,305 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:47:28,305 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728
2025-06-17 16:47:28,306 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:47:28,306 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:47:28,477 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:47:28,477 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:47:28,477 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:47:31,506 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:47:31,506 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:47:31,507 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:47:31,724 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:47:31,724 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:47:31,724 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 16:47:31,724 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:47:31,724 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 16:47:31,725 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:47:31,725 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:47:31,725 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:47:31,898 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:47:31,898 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:47:34,321 - __main__ - INFO - Preparing batch with size 4, max_length 1024...
2025-06-17 16:47:34,324 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:47:34,325 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:47:55,416 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:47:55,416 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:47:55,417 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:47:55,417 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:47:55,417 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:47:58,033 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:49:02,719 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.30秒
2025-06-17 16:49:02,719 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:49:02,719 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:49:02,720 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10888.7MB
2025-06-17 16:49:02,739 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10472.7MB, 样本=596
2025-06-17 16:49:02,739 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 16:49:02,739 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10472.7MB, 样本=596
2025-06-17 16:49:02,739 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 16:49:02,740 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs4_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728.json
2025-06-17 16:49:02,740 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728', 'timestamp': '2025-06-17T16:49:02.739519', 'performance': {'success': True, 'ttft_ms': 2616.02520942688, 'tpot_ms': 1320.1112601221826, 'throughput_tokens_per_sec': 0.7429147454218531, 'total_time_sec': 67.30247354507446, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10888.6513671875, 'average_memory_mb': 10472.732362888004, 'sample_count': 596}, 'total_peak_memory_mb': 10888.6513671875}, 'system': {'peak_cpu_percent': 13.1, 'average_cpu_percent': 5.798507462686567, 'peak_memory_percent': 45.6, 'peak_memory_used_gb': 29.121849060058594, 'sample_count': 67}, 'monitoring_duration': 67.32310581207275}
2025-06-17 16:49:02,740 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728 的资源...
2025-06-17 16:49:03,105 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs4_rep0_20250617_164728 资源清理完成
2025-06-17 16:49:03,111 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs4_rep0
2025-06-17 16:49:03,179 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 8
2025-06-17 16:49:03,318 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903
2025-06-17 16:49:03,390 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:49:03,390 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:49:03,391 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903
2025-06-17 16:49:03,391 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:49:03,391 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:49:03,501 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:49:03,501 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:49:03,502 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:49:06,574 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:49:06,574 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:49:06,575 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:49:06,789 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:49:06,789 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:49:06,789 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 16:49:06,789 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:49:06,789 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 16:49:06,789 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:49:06,789 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:49:06,789 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:49:06,964 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:49:06,965 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:49:09,699 - __main__ - INFO - Preparing batch with size 8, max_length 1024...
2025-06-17 16:49:09,704 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:49:09,704 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:49:36,586 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:49:36,586 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:49:36,586 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:49:36,587 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:49:36,587 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:49:45,464 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:51:10,668 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 94.08秒
2025-06-17 16:51:10,668 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:51:10,668 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:51:10,669 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11804.8MB
2025-06-17 16:51:10,679 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11017.4MB, 样本=834
2025-06-17 16:51:10,679 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 16:51:10,679 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11017.4MB, 样本=834
2025-06-17 16:51:10,679 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 16:51:10,680 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs8_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903.json
2025-06-17 16:51:10,680 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903', 'timestamp': '2025-06-17T16:51:10.679388', 'performance': {'success': True, 'ttft_ms': 8877.044439315796, 'tpot_ms': 1738.8263478571055, 'throughput_tokens_per_sec': 0.5314595766451004, 'total_time_sec': 94.08053255081177, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11804.8076171875, 'average_memory_mb': 11017.384448300734, 'sample_count': 834}, 'total_peak_memory_mb': 11804.8076171875}, 'system': {'peak_cpu_percent': 15.9, 'average_cpu_percent': 6.07956989247312, 'peak_memory_percent': 44.6, 'peak_memory_used_gb': 28.49248504638672, 'sample_count': 93}, 'monitoring_duration': 94.0924928188324}
2025-06-17 16:51:10,680 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903 的资源...
2025-06-17 16:51:11,067 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs8_rep0_20250617_164903 资源清理完成
2025-06-17 16:51:11,073 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs8_rep0
2025-06-17 16:51:11,145 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 1
2025-06-17 16:51:11,290 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111
2025-06-17 16:51:11,360 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:51:11,360 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:51:11,361 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111
2025-06-17 16:51:11,361 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:51:11,361 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:51:11,433 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:51:11,433 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:51:11,433 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:51:14,412 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:51:14,412 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:51:14,413 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:51:14,625 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:51:14,625 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:51:14,625 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 16:51:14,625 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:51:14,626 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 16:51:14,626 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:51:14,626 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:51:14,626 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:51:14,800 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:51:14,800 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:51:17,378 - __main__ - INFO - Preparing batch with size 1, max_length 2048...
2025-06-17 16:51:17,380 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:51:17,380 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:51:33,418 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:51:33,418 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:51:33,419 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:51:33,419 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:51:33,421 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:51:35,941 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:52:40,629 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.21秒
2025-06-17 16:52:40,629 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:52:40,629 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:52:40,630 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10616.6MB
2025-06-17 16:52:40,700 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.7MB, 样本=596
2025-06-17 16:52:40,700 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 16:52:40,701 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.7MB, 样本=596
2025-06-17 16:52:40,701 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 16:52:40,702 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs1_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111.json
2025-06-17 16:52:40,702 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111', 'timestamp': '2025-06-17T16:52:40.700933', 'performance': {'success': True, 'ttft_ms': 2520.5588340759277, 'tpot_ms': 1320.132080389529, 'throughput_tokens_per_sec': 0.7439587469618876, 'total_time_sec': 67.20802760124207, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10616.5810546875, 'average_memory_mb': 10205.712086927171, 'sample_count': 596}, 'total_peak_memory_mb': 10616.5810546875}, 'system': {'peak_cpu_percent': 11.0, 'average_cpu_percent': 5.8149253731343284, 'peak_memory_percent': 44.0, 'peak_memory_used_gb': 28.111839294433594, 'sample_count': 67}, 'monitoring_duration': 67.28283476829529}
2025-06-17 16:52:40,702 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111 的资源...
2025-06-17 16:52:41,068 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs1_rep0_20250617_165111 资源清理完成
2025-06-17 16:52:41,074 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs1_rep0
2025-06-17 16:52:41,147 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 4
2025-06-17 16:52:41,287 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241
2025-06-17 16:52:41,360 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:52:41,360 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:52:41,360 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241
2025-06-17 16:52:41,360 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:52:41,360 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:52:41,433 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:52:41,434 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:52:41,434 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:52:44,477 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:52:44,477 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:52:44,478 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:52:44,701 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:52:44,701 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:52:44,701 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 16:52:44,702 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:52:44,702 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 16:52:44,702 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:52:44,702 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:52:44,702 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:52:44,877 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:52:44,877 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:52:47,673 - __main__ - INFO - Preparing batch with size 4, max_length 2048...
2025-06-17 16:52:47,678 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:52:47,678 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:53:11,775 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:53:11,775 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:53:11,776 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:53:11,777 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:53:11,778 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:53:19,749 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:54:32,619 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 80.84秒
2025-06-17 16:54:32,619 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:54:32,619 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:54:32,620 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11820.8MB
2025-06-17 16:54:32,671 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10995.4MB, 样本=717
2025-06-17 16:54:32,671 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 16:54:32,671 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10995.4MB, 样本=717
2025-06-17 16:54:32,671 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 16:54:32,672 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs4_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241.json
2025-06-17 16:54:32,672 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241', 'timestamp': '2025-06-17T16:54:32.671496', 'performance': {'success': True, 'ttft_ms': 7970.731019973755, 'tpot_ms': 1487.1267250605993, 'throughput_tokens_per_sec': 0.61849852030899, 'total_time_sec': 80.84093713760376, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11820.8154296875, 'average_memory_mb': 10995.382954830238, 'sample_count': 717}, 'total_peak_memory_mb': 11820.8154296875}, 'system': {'peak_cpu_percent': 12.3, 'average_cpu_percent': 5.686249999999999, 'peak_memory_percent': 45.2, 'peak_memory_used_gb': 28.836597442626953, 'sample_count': 80}, 'monitoring_duration': 80.89559888839722}
2025-06-17 16:54:32,672 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241 的资源...
2025-06-17 16:54:33,059 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs4_rep0_20250617_165241 资源清理完成
2025-06-17 16:54:33,064 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs4_rep0
2025-06-17 16:54:33,136 - __main__ - INFO - Running FullKVCache: Rep 1/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 8
2025-06-17 16:54:33,275 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433
2025-06-17 16:54:33,343 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:54:33,343 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:54:33,343 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433
2025-06-17 16:54:33,343 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:54:33,343 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:54:33,413 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:54:33,413 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:54:33,413 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:54:36,505 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:54:36,506 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:54:36,506 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:54:36,720 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:54:36,720 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:54:36,721 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 16:54:36,721 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:54:36,721 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 16:54:36,721 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:54:36,721 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:54:36,721 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:54:36,895 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:54:36,896 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:54:40,222 - __main__ - INFO - Preparing batch with size 8, max_length 2048...
2025-06-17 16:54:40,229 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:54:40,229 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:55:23,859 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:55:23,859 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:55:23,860 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:55:23,860 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:55:23,860 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:56:02,180 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:57:42,577 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 138.72秒
2025-06-17 16:57:42,577 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:57:42,577 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:57:42,578 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9833.0MB, 最终峰值=13809.1MB
2025-06-17 16:57:42,629 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12100.4MB, 样本=1229
2025-06-17 16:57:42,630 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 16:57:42,631 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12100.4MB, 样本=1229
2025-06-17 16:57:42,631 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 16:57:42,633 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs8_rep0\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433.json
2025-06-17 16:57:42,634 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433', 'timestamp': '2025-06-17T16:57:42.631925', 'performance': {'success': True, 'ttft_ms': 38320.15585899353, 'tpot_ms': 2048.9045843786125, 'throughput_tokens_per_sec': 0.36044484903618534, 'total_time_sec': 138.7174768447876, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 0}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 13809.1279296875, 'average_memory_mb': 12100.378048082792, 'sample_count': 1229}, 'total_peak_memory_mb': 13809.1279296875}, 'system': {'peak_cpu_percent': 14.6, 'average_cpu_percent': 5.621897810218978, 'peak_memory_percent': 44.0, 'peak_memory_used_gb': 28.073810577392578, 'sample_count': 137}, 'monitoring_duration': 138.77240705490112}
2025-06-17 16:57:42,634 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433 的资源...
2025-06-17 16:57:43,050 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs8_rep0_20250617_165433 资源清理完成
2025-06-17 16:57:43,057 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs8_rep0
2025-06-17 16:57:43,129 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 128, Batch: 1
2025-06-17 16:57:43,285 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743
2025-06-17 16:57:43,356 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:57:43,356 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:57:43,356 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743
2025-06-17 16:57:43,356 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:57:43,356 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:57:43,427 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:57:43,427 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:57:43,427 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:57:46,452 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:57:46,452 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:57:46,452 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:57:46,668 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:57:46,669 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:57:46,669 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 16:57:46,669 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:57:46,669 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 16:57:46,669 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:57:46,669 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:57:46,669 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:57:46,841 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:57:46,841 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:57:50,290 - __main__ - INFO - Preparing batch with size 1, max_length 128...
2025-06-17 16:57:50,292 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:57:50,292 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:57:59,781 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:57:59,782 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:57:59,784 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:57:59,784 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:57:59,786 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:58:01,231 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 16:59:05,590 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 65.80秒
2025-06-17 16:59:05,590 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 16:59:05,590 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 16:59:05,591 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10366.8MB
2025-06-17 16:59:05,630 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9966.1MB, 样本=584
2025-06-17 16:59:05,630 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 16:59:05,631 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9966.1MB, 样本=584
2025-06-17 16:59:05,631 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 16:59:05,632 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs1_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743.json
2025-06-17 16:59:05,632 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743', 'timestamp': '2025-06-17T16:59:05.630153', 'performance': {'success': True, 'ttft_ms': 1445.0280666351318, 'tpot_ms': 1313.456661847173, 'throughput_tokens_per_sec': 0.7598217717028309, 'total_time_sec': 65.80490565299988, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10366.75341796875, 'average_memory_mb': 9966.1203721974, 'sample_count': 584}, 'total_peak_memory_mb': 10366.75341796875}, 'system': {'peak_cpu_percent': 11.2, 'average_cpu_percent': 5.779999999999999, 'peak_memory_percent': 43.3, 'peak_memory_used_gb': 27.614856719970703, 'sample_count': 65}, 'monitoring_duration': 65.84905982017517}
2025-06-17 16:59:05,632 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743 的资源...
2025-06-17 16:59:06,033 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs1_rep1_20250617_165743 资源清理完成
2025-06-17 16:59:06,055 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs1_rep1
2025-06-17 16:59:06,177 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 128, Batch: 4
2025-06-17 16:59:06,325 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906
2025-06-17 16:59:06,400 - __main__ - INFO - 实验前内存清理完成
2025-06-17 16:59:06,400 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 16:59:06,401 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906
2025-06-17 16:59:06,401 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 16:59:06,401 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 16:59:06,475 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 16:59:06,476 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 16:59:06,476 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 16:59:09,507 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 16:59:09,508 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 16:59:09,508 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 16:59:09,731 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 16:59:09,731 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 16:59:09,731 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 16:59:09,731 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 16:59:09,731 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 16:59:09,732 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 16:59:09,732 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 16:59:09,732 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 16:59:09,937 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 16:59:09,943 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 16:59:12,478 - __main__ - INFO - Preparing batch with size 4, max_length 128...
2025-06-17 16:59:12,480 - __main__ - INFO - 输入数据验证通过
2025-06-17 16:59:12,480 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 16:59:25,088 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 16:59:25,088 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 16:59:25,088 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 16:59:25,089 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 16:59:25,089 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 16:59:29,186 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:00:33,100 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 68.01秒
2025-06-17 17:00:33,101 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:00:33,101 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:00:33,101 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10435.2MB
2025-06-17 17:00:33,118 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10029.3MB, 样本=603
2025-06-17 17:00:33,118 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 17:00:33,118 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10029.3MB, 样本=603
2025-06-17 17:00:33,118 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 17:00:33,119 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs4_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906.json
2025-06-17 17:00:33,119 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906', 'timestamp': '2025-06-17T17:00:33.118298', 'performance': {'success': True, 'ttft_ms': 4096.663951873779, 'tpot_ms': 1304.3445081126933, 'throughput_tokens_per_sec': 0.7351801517428755, 'total_time_sec': 68.01054120063782, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10435.15380859375, 'average_memory_mb': 10029.25162112614, 'sample_count': 603}, 'total_peak_memory_mb': 10435.15380859375}, 'system': {'peak_cpu_percent': 12.1, 'average_cpu_percent': 5.946268656716418, 'peak_memory_percent': 44.4, 'peak_memory_used_gb': 28.317562103271484, 'sample_count': 67}, 'monitoring_duration': 68.02951169013977}
2025-06-17 17:00:33,119 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906 的资源...
2025-06-17 17:00:33,494 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs4_rep1_20250617_165906 资源清理完成
2025-06-17 17:00:33,497 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs4_rep1
2025-06-17 17:00:33,572 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 128, Batch: 8
2025-06-17 17:00:33,715 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033
2025-06-17 17:00:33,787 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:00:33,788 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:00:33,788 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033
2025-06-17 17:00:33,788 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:00:33,788 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:00:33,860 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:00:33,860 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:00:33,860 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:00:36,922 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:00:36,922 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:00:36,923 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:00:37,140 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:00:37,140 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:00:37,140 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 17:00:37,140 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:00:37,140 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 17:00:37,140 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:00:37,141 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:00:37,141 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:00:37,309 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:00:37,309 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:00:39,366 - datasets.load - WARNING - Using the latest cached version of the dataset since THUDM/LongBench couldn't be found on the Hugging Face Hub
2025-06-17 17:00:39,367 - datasets.packaged_modules.cache.cache - WARNING - Found the latest cached dataset configuration 'hotpotqa' at C:\Users\JerryGanst\.cache\huggingface\datasets\THUDM___long_bench\hotpotqa\1.0.0\5e628be450b7e67fb7ae6e201bd6d8f7056f7672 (last modified on Wed Jun 11 09:37:02 2025).
2025-06-17 17:00:39,377 - __main__ - INFO - Preparing batch with size 8, max_length 128...
2025-06-17 17:00:39,380 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:00:39,381 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:00:51,627 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:00:51,627 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:00:51,627 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:00:51,628 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:00:51,628 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:00:54,759 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:01:59,409 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.78秒
2025-06-17 17:01:59,409 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:01:59,410 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:01:59,410 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10530.5MB
2025-06-17 17:01:59,416 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10530.5MB, 平均=10093.8MB, 样本=601
2025-06-17 17:01:59,416 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10530.5MB
2025-06-17 17:01:59,416 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10530.5MB, 平均=10093.8MB, 样本=601
2025-06-17 17:01:59,416 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10530.5MB
2025-06-17 17:01:59,417 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs8_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033.json
2025-06-17 17:01:59,417 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033', 'timestamp': '2025-06-17T17:01:59.416635', 'performance': {'success': True, 'ttft_ms': 3131.004810333252, 'tpot_ms': 1319.3947733665, 'throughput_tokens_per_sec': 0.7376660534949854, 'total_time_sec': 67.78134870529175, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10530.48876953125, 'average_memory_mb': 10093.78165297421, 'sample_count': 601}, 'total_peak_memory_mb': 10530.48876953125}, 'system': {'peak_cpu_percent': 86.5, 'average_cpu_percent': 6.902985074626867, 'peak_memory_percent': 43.6, 'peak_memory_used_gb': 27.816192626953125, 'sample_count': 67}, 'monitoring_duration': 67.7893271446228}
2025-06-17 17:01:59,417 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033 的资源...
2025-06-17 17:01:59,796 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs8_rep1_20250617_170033 资源清理完成
2025-06-17 17:01:59,800 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs8_rep1
2025-06-17 17:01:59,873 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 256, Batch: 1
2025-06-17 17:02:00,019 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200
2025-06-17 17:02:00,088 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:02:00,088 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:02:00,088 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200
2025-06-17 17:02:00,089 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:02:00,089 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:02:00,157 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:02:00,157 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:02:00,157 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:02:03,142 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:02:03,142 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:02:03,143 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:02:03,357 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:02:03,357 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:02:03,357 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:02:03,357 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:02:03,357 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:02:03,357 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:02:03,357 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:02:03,357 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:02:03,525 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:02:03,525 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:02:06,143 - __main__ - INFO - Preparing batch with size 1, max_length 256...
2025-06-17 17:02:06,145 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:02:06,145 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:02:17,177 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:02:17,177 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:02:17,178 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:02:17,178 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:02:17,179 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:02:19,992 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:03:24,166 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.99秒
2025-06-17 17:03:24,166 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:03:24,166 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:03:24,167 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10382.8MB
2025-06-17 17:03:24,171 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9973.1MB, 样本=595
2025-06-17 17:03:24,171 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 17:03:24,171 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9973.1MB, 样本=595
2025-06-17 17:03:24,171 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 17:03:24,172 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs1_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200.json
2025-06-17 17:03:24,172 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200', 'timestamp': '2025-06-17T17:03:24.171711', 'performance': {'success': True, 'ttft_ms': 2813.128709793091, 'tpot_ms': 1309.6780387722715, 'throughput_tokens_per_sec': 0.7464095542239535, 'total_time_sec': 66.9873526096344, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10382.75830078125, 'average_memory_mb': 9973.148894596901, 'sample_count': 595}, 'total_peak_memory_mb': 10382.75830078125}, 'system': {'peak_cpu_percent': 14.5, 'average_cpu_percent': 5.987878787878788, 'peak_memory_percent': 44.2, 'peak_memory_used_gb': 28.242374420166016, 'sample_count': 66}, 'monitoring_duration': 66.9943540096283}
2025-06-17 17:03:24,172 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200 的资源...
2025-06-17 17:03:24,547 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs1_rep1_20250617_170200 资源清理完成
2025-06-17 17:03:24,553 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs1_rep1
2025-06-17 17:03:24,725 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 256, Batch: 4
2025-06-17 17:03:24,869 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324
2025-06-17 17:03:24,942 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:03:24,943 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:03:24,943 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324
2025-06-17 17:03:24,943 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:03:24,943 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:03:25,015 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:03:25,016 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:03:25,016 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:03:28,213 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:03:28,213 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:03:28,213 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:03:28,431 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:03:28,431 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:03:28,431 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:03:28,432 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:03:28,432 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:03:28,432 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:03:28,432 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:03:28,432 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:03:28,605 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:03:28,606 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:03:31,169 - __main__ - INFO - Preparing batch with size 4, max_length 256...
2025-06-17 17:03:31,174 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:03:31,174 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:03:43,842 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:03:43,843 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:03:43,845 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:03:43,846 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:03:43,848 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:03:46,698 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:04:50,732 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.88秒
2025-06-17 17:04:50,732 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:04:50,732 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:04:50,732 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10499.4MB
2025-06-17 17:04:50,773 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10086.9MB, 样本=594
2025-06-17 17:04:50,773 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 17:04:50,773 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10086.9MB, 样本=594
2025-06-17 17:04:50,773 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 17:04:50,774 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs4_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324.json
2025-06-17 17:04:50,774 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324', 'timestamp': '2025-06-17T17:04:50.773007', 'performance': {'success': True, 'ttft_ms': 2850.123882293701, 'tpot_ms': 1306.7882790857432, 'throughput_tokens_per_sec': 0.7475657821257707, 'total_time_sec': 66.88374614715576, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10499.43896484375, 'average_memory_mb': 10086.909181331544, 'sample_count': 594}, 'total_peak_memory_mb': 10499.43896484375}, 'system': {'peak_cpu_percent': 14.3, 'average_cpu_percent': 5.943939393939394, 'peak_memory_percent': 44.0, 'peak_memory_used_gb': 28.100143432617188, 'sample_count': 66}, 'monitoring_duration': 66.92939233779907}
2025-06-17 17:04:50,774 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324 的资源...
2025-06-17 17:04:51,157 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs4_rep1_20250617_170324 资源清理完成
2025-06-17 17:04:51,160 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs4_rep1
2025-06-17 17:04:51,233 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 256, Batch: 8
2025-06-17 17:04:51,383 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451
2025-06-17 17:04:51,454 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:04:51,454 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:04:51,454 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451
2025-06-17 17:04:51,454 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:04:51,454 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:04:51,525 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:04:51,525 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:04:51,525 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:04:54,524 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:04:54,525 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:04:54,525 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:04:54,739 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:04:54,740 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:04:54,740 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:04:54,740 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:04:54,740 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:04:54,740 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:04:54,740 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:04:54,740 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:04:54,913 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:04:54,913 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:04:58,031 - __main__ - INFO - Preparing batch with size 8, max_length 256...
2025-06-17 17:04:58,036 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:04:58,036 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:05:13,599 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:05:13,599 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:05:13,600 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:05:13,600 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:05:13,601 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:05:17,204 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:06:23,919 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 70.32秒
2025-06-17 17:06:23,919 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:06:23,919 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:06:23,920 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10658.1MB
2025-06-17 17:06:23,953 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10234.0MB, 样本=623
2025-06-17 17:06:23,953 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 17:06:23,953 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10234.0MB, 样本=623
2025-06-17 17:06:23,953 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 17:06:23,954 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs8_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451.json
2025-06-17 17:06:23,954 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451', 'timestamp': '2025-06-17T17:06:23.953059', 'performance': {'success': True, 'ttft_ms': 3603.0285358428955, 'tpot_ms': 1361.5074109057991, 'throughput_tokens_per_sec': 0.7110566206881118, 'total_time_sec': 70.3178882598877, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10658.13720703125, 'average_memory_mb': 10233.967200510384, 'sample_count': 623}, 'total_peak_memory_mb': 10658.13720703125}, 'system': {'peak_cpu_percent': 51.4, 'average_cpu_percent': 6.472857142857144, 'peak_memory_percent': 44.7, 'peak_memory_used_gb': 28.503158569335938, 'sample_count': 70}, 'monitoring_duration': 70.35377216339111}
2025-06-17 17:06:23,955 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451 的资源...
2025-06-17 17:06:24,346 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs8_rep1_20250617_170451 资源清理完成
2025-06-17 17:06:24,349 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs8_rep1
2025-06-17 17:06:24,417 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 512, Batch: 1
2025-06-17 17:06:24,565 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624
2025-06-17 17:06:24,642 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:06:24,642 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:06:24,642 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624
2025-06-17 17:06:24,643 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:06:24,643 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:06:24,715 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:06:24,716 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:06:24,716 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:06:28,169 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:06:28,169 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:06:28,170 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:06:28,386 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:06:28,387 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:06:28,387 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:06:28,387 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:06:28,387 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:06:28,387 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:06:28,387 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:06:28,387 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:06:28,555 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:06:28,555 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:06:31,413 - __main__ - INFO - Preparing batch with size 1, max_length 512...
2025-06-17 17:06:31,415 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:06:31,416 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:06:44,179 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:06:44,179 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:06:44,180 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:06:44,180 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:06:44,180 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:06:48,459 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:07:53,302 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 69.12秒
2025-06-17 17:07:53,303 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:07:53,303 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:07:53,303 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10432.5MB
2025-06-17 17:07:53,328 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10029.5MB, 样本=614
2025-06-17 17:07:53,328 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 17:07:53,328 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10029.5MB, 样本=614
2025-06-17 17:07:53,328 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 17:07:53,329 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs1_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624.json
2025-06-17 17:07:53,329 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624', 'timestamp': '2025-06-17T17:07:53.328802', 'performance': {'success': True, 'ttft_ms': 4279.374361038208, 'tpot_ms': 1323.3263443927376, 'throughput_tokens_per_sec': 0.7233548769502318, 'total_time_sec': 69.12236523628235, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10432.52001953125, 'average_memory_mb': 10029.528035614312, 'sample_count': 614}, 'total_peak_memory_mb': 10432.52001953125}, 'system': {'peak_cpu_percent': 15.2, 'average_cpu_percent': 5.861764705882354, 'peak_memory_percent': 44.0, 'peak_memory_used_gb': 28.06153106689453, 'sample_count': 68}, 'monitoring_duration': 69.14927554130554}
2025-06-17 17:07:53,329 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624 的资源...
2025-06-17 17:07:53,722 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs1_rep1_20250617_170624 资源清理完成
2025-06-17 17:07:53,725 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs1_rep1
2025-06-17 17:07:53,798 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 512, Batch: 4
2025-06-17 17:07:53,936 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753
2025-06-17 17:07:54,004 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:07:54,004 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:07:54,004 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753
2025-06-17 17:07:54,004 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:07:54,004 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:07:54,077 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:07:54,077 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:07:54,077 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:07:57,438 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:07:57,439 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:07:57,439 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:07:57,654 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:07:57,655 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:07:57,655 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:07:57,655 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:07:57,655 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:07:57,655 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:07:57,655 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:07:57,655 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:07:57,824 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:07:57,824 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:08:00,280 - __main__ - INFO - Preparing batch with size 4, max_length 512...
2025-06-17 17:08:00,283 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:08:00,283 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:08:16,040 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:08:16,040 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:08:16,042 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:08:16,042 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:08:16,044 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:08:18,857 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:09:23,424 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.38秒
2025-06-17 17:09:23,424 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:09:23,425 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:09:23,425 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10633.1MB
2025-06-17 17:09:23,451 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10222.2MB, 样本=597
2025-06-17 17:09:23,451 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 17:09:23,451 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10222.2MB, 样本=597
2025-06-17 17:09:23,451 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 17:09:23,452 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs4_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753.json
2025-06-17 17:09:23,452 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753', 'timestamp': '2025-06-17T17:09:23.451350', 'performance': {'success': True, 'ttft_ms': 2813.0240440368652, 'tpot_ms': 1317.6707832180723, 'throughput_tokens_per_sec': 0.7420611807709133, 'total_time_sec': 67.37988901138306, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10633.11865234375, 'average_memory_mb': 10222.168796456239, 'sample_count': 597}, 'total_peak_memory_mb': 10633.11865234375}, 'system': {'peak_cpu_percent': 12.0, 'average_cpu_percent': 5.741791044776119, 'peak_memory_percent': 43.9, 'peak_memory_used_gb': 28.02391815185547, 'sample_count': 67}, 'monitoring_duration': 67.41088604927063}
2025-06-17 17:09:23,452 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753 的资源...
2025-06-17 17:09:23,850 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs4_rep1_20250617_170753 资源清理完成
2025-06-17 17:09:23,854 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs4_rep1
2025-06-17 17:09:23,925 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 512, Batch: 8
2025-06-17 17:09:24,072 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924
2025-06-17 17:09:24,152 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:09:24,152 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:09:24,152 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924
2025-06-17 17:09:24,152 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:09:24,152 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:09:24,225 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:09:24,225 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:09:24,225 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:09:27,618 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:09:27,619 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:09:27,619 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:09:27,840 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:09:27,841 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:09:27,841 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:09:27,841 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:09:27,841 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:09:27,841 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:09:27,841 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:09:27,841 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:09:28,023 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:09:28,024 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:09:30,410 - __main__ - INFO - Preparing batch with size 8, max_length 512...
2025-06-17 17:09:30,416 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:09:30,416 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:09:51,498 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:09:51,498 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:09:51,499 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:09:51,499 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:09:51,500 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:09:54,069 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:11:00,239 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 68.74秒
2025-06-17 17:11:00,239 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:11:00,239 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:11:00,240 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10909.5MB
2025-06-17 17:11:00,253 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10486.4MB, 样本=609
2025-06-17 17:11:00,253 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 17:11:00,253 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10486.4MB, 样本=609
2025-06-17 17:11:00,253 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 17:11:00,254 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs8_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924.json
2025-06-17 17:11:00,254 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924', 'timestamp': '2025-06-17T17:11:00.253701', 'performance': {'success': True, 'ttft_ms': 2569.0982341766357, 'tpot_ms': 1350.3947452623017, 'throughput_tokens_per_sec': 0.7273844867001733, 'total_time_sec': 68.7394368648529, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10909.52783203125, 'average_memory_mb': 10486.39916551211, 'sample_count': 609}, 'total_peak_memory_mb': 10909.52783203125}, 'system': {'peak_cpu_percent': 12.5, 'average_cpu_percent': 6.132352941176471, 'peak_memory_percent': 42.5, 'peak_memory_used_gb': 27.146312713623047, 'sample_count': 68}, 'monitoring_duration': 68.75541949272156}
2025-06-17 17:11:00,254 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924 的资源...
2025-06-17 17:11:00,664 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs8_rep1_20250617_170924 资源清理完成
2025-06-17 17:11:00,667 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs8_rep1
2025-06-17 17:11:00,749 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 1
2025-06-17 17:11:00,998 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100
2025-06-17 17:11:01,069 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:11:01,069 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:11:01,069 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100
2025-06-17 17:11:01,069 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:11:01,069 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:11:01,143 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:11:01,143 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:11:01,143 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:11:04,163 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:11:04,163 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:11:04,163 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:11:04,379 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:11:04,379 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:11:04,379 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:11:04,379 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:11:04,379 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:11:04,379 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:11:04,379 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:11:04,379 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:11:04,553 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:11:04,554 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:11:07,554 - __main__ - INFO - Preparing batch with size 1, max_length 1024...
2025-06-17 17:11:07,557 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:11:07,558 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:11:19,979 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:11:19,979 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:11:19,981 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:11:19,981 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:11:19,983 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:11:22,171 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:12:26,938 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.96秒
2025-06-17 17:12:26,938 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:12:26,938 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:12:26,938 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10480.5MB
2025-06-17 17:12:26,954 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10077.8MB, 样本=592
2025-06-17 17:12:26,954 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 17:12:26,954 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10077.8MB, 样本=592
2025-06-17 17:12:26,954 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 17:12:26,955 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs1_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100.json
2025-06-17 17:12:26,955 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100', 'timestamp': '2025-06-17T17:12:26.954144', 'performance': {'success': True, 'ttft_ms': 2188.504934310913, 'tpot_ms': 1321.7497212546211, 'throughput_tokens_per_sec': 0.7467675658247839, 'total_time_sec': 66.955237865448, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10480.5341796875, 'average_memory_mb': 10077.826975229624, 'sample_count': 592}, 'total_peak_memory_mb': 10480.5341796875}, 'system': {'peak_cpu_percent': 44.0, 'average_cpu_percent': 6.490909090909091, 'peak_memory_percent': 44.5, 'peak_memory_used_gb': 28.398563385009766, 'sample_count': 66}, 'monitoring_duration': 66.9747633934021}
2025-06-17 17:12:26,955 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100 的资源...
2025-06-17 17:12:27,355 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs1_rep1_20250617_171100 资源清理完成
2025-06-17 17:12:27,359 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs1_rep1
2025-06-17 17:12:27,438 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 4
2025-06-17 17:12:27,592 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227
2025-06-17 17:12:27,664 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:12:27,664 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:12:27,665 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227
2025-06-17 17:12:27,665 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:12:27,665 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:12:27,738 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:12:27,739 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:12:27,739 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:12:30,797 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:12:30,798 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:12:30,798 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:12:31,011 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:12:31,011 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:12:31,012 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:12:31,012 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:12:31,012 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:12:31,012 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:12:31,012 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:12:31,012 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:12:31,182 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:12:31,182 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:12:33,422 - __main__ - INFO - Preparing batch with size 4, max_length 1024...
2025-06-17 17:12:33,426 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:12:33,426 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:12:56,360 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:12:56,360 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:12:56,361 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:12:56,362 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:12:56,364 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:13:07,301 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:14:26,666 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 90.30秒
2025-06-17 17:14:26,666 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:14:26,666 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:14:26,666 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10888.7MB
2025-06-17 17:14:26,675 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10496.4MB, 样本=800
2025-06-17 17:14:26,675 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 17:14:26,675 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10496.4MB, 样本=800
2025-06-17 17:14:26,675 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 17:14:26,676 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs4_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227.json
2025-06-17 17:14:26,676 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227', 'timestamp': '2025-06-17T17:14:26.675943', 'performance': {'success': True, 'ttft_ms': 10936.646461486816, 'tpot_ms': 1619.6856547375114, 'throughput_tokens_per_sec': 0.553696117196843, 'total_time_sec': 90.30224061012268, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10888.6513671875, 'average_memory_mb': 10496.412302856445, 'sample_count': 800}, 'total_peak_memory_mb': 10888.6513671875}, 'system': {'peak_cpu_percent': 12.8, 'average_cpu_percent': 6.092134831460674, 'peak_memory_percent': 43.4, 'peak_memory_used_gb': 27.709678649902344, 'sample_count': 89}, 'monitoring_duration': 90.31523537635803}
2025-06-17 17:14:26,676 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227 的资源...
2025-06-17 17:14:27,103 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs4_rep1_20250617_171227 资源清理完成
2025-06-17 17:14:27,106 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs4_rep1
2025-06-17 17:14:27,180 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 8
2025-06-17 17:14:27,371 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427
2025-06-17 17:14:27,503 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:14:27,503 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:14:27,503 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427
2025-06-17 17:14:27,503 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:14:27,503 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:14:27,576 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:14:27,576 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:14:27,576 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:14:30,531 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:14:30,532 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:14:30,532 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:14:30,746 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:14:30,746 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:14:30,746 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:14:30,746 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:14:30,747 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:14:30,747 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:14:30,747 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:14:30,747 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:14:30,917 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:14:30,918 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:14:33,736 - __main__ - INFO - Preparing batch with size 8, max_length 1024...
2025-06-17 17:14:33,741 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:14:33,741 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:14:58,072 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:14:58,073 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:14:58,075 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:14:58,075 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:14:58,076 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:15:06,019 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:16:15,762 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 77.69秒
2025-06-17 17:16:15,762 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:16:15,762 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:16:15,762 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11804.8MB
2025-06-17 17:16:15,795 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11011.7MB, 样本=688
2025-06-17 17:16:15,795 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 17:16:15,795 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11011.7MB, 样本=688
2025-06-17 17:16:15,795 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 17:16:15,796 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs8_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427.json
2025-06-17 17:16:15,796 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427', 'timestamp': '2025-06-17T17:16:15.795214', 'performance': {'success': True, 'ttft_ms': 7943.169593811035, 'tpot_ms': 1423.3015021499323, 'throughput_tokens_per_sec': 0.6436171073230219, 'total_time_sec': 77.68594002723694, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11804.8076171875, 'average_memory_mb': 11011.734905154206, 'sample_count': 688}, 'total_peak_memory_mb': 11804.8076171875}, 'system': {'peak_cpu_percent': 9.7, 'average_cpu_percent': 6.024675324675325, 'peak_memory_percent': 44.7, 'peak_memory_used_gb': 28.533267974853516, 'sample_count': 77}, 'monitoring_duration': 77.72281885147095}
2025-06-17 17:16:15,796 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427 的资源...
2025-06-17 17:16:16,216 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs8_rep1_20250617_171427 资源清理完成
2025-06-17 17:16:16,240 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs8_rep1
2025-06-17 17:16:16,349 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 1
2025-06-17 17:16:16,499 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616
2025-06-17 17:16:16,574 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:16:16,574 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:16:16,574 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616
2025-06-17 17:16:16,574 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:16:16,574 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:16:16,647 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:16:16,647 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:16:16,647 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:16:19,642 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:16:19,643 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:16:19,643 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:16:19,856 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:16:19,857 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:16:19,857 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:16:19,857 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:16:19,857 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:16:19,857 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:16:19,857 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:16:19,857 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:16:20,032 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:16:20,032 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:16:22,399 - __main__ - INFO - Preparing batch with size 1, max_length 2048...
2025-06-17 17:16:22,402 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:16:22,402 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:16:37,891 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:16:37,891 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:16:37,892 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:16:37,892 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:16:37,893 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:16:39,873 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:17:44,523 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.63秒
2025-06-17 17:17:44,523 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:17:44,523 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:17:44,524 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10616.6MB
2025-06-17 17:17:44,559 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.6MB, 样本=591
2025-06-17 17:17:44,559 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 17:17:44,559 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.6MB, 样本=591
2025-06-17 17:17:44,560 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 17:17:44,560 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs1_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616.json
2025-06-17 17:17:44,561 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616', 'timestamp': '2025-06-17T17:17:44.559753', 'performance': {'success': True, 'ttft_ms': 1979.9208641052246, 'tpot_ms': 1319.3441994336185, 'throughput_tokens_per_sec': 0.7504152094939244, 'total_time_sec': 66.62977957725525, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10616.5810546875, 'average_memory_mb': 10205.592553669629, 'sample_count': 591}, 'total_peak_memory_mb': 10616.5810546875}, 'system': {'peak_cpu_percent': 11.9, 'average_cpu_percent': 6.25, 'peak_memory_percent': 43.4, 'peak_memory_used_gb': 27.683307647705078, 'sample_count': 66}, 'monitoring_duration': 66.66776084899902}
2025-06-17 17:17:44,561 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616 的资源...
2025-06-17 17:17:44,972 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs1_rep1_20250617_171616 资源清理完成
2025-06-17 17:17:44,976 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs1_rep1
2025-06-17 17:17:45,050 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 4
2025-06-17 17:17:45,191 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745
2025-06-17 17:17:45,263 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:17:45,264 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:17:45,264 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745
2025-06-17 17:17:45,264 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:17:45,264 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:17:45,336 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:17:45,336 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:17:45,337 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:17:48,344 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:17:48,345 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:17:48,345 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:17:48,560 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:17:48,560 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:17:48,560 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:17:48,560 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:17:48,560 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:17:48,560 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:17:48,561 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:17:48,561 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:17:48,731 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:17:48,731 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:17:51,486 - __main__ - INFO - Preparing batch with size 4, max_length 2048...
2025-06-17 17:17:51,489 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:17:51,490 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:18:15,501 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:18:15,501 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:18:15,502 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:18:15,502 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:18:15,503 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:18:23,398 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:19:30,471 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 74.97秒
2025-06-17 17:19:30,471 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:19:30,471 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:19:30,472 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11820.8MB
2025-06-17 17:19:30,496 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10995.6MB, 样本=665
2025-06-17 17:19:30,496 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 17:19:30,496 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10995.6MB, 样本=665
2025-06-17 17:19:30,496 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 17:19:30,497 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs4_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745.json
2025-06-17 17:19:30,497 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745', 'timestamp': '2025-06-17T17:19:30.496393', 'performance': {'success': True, 'ttft_ms': 7895.544528961182, 'tpot_ms': 1368.8130086782026, 'throughput_tokens_per_sec': 0.6669478669565274, 'total_time_sec': 74.96837830543518, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11820.8154296875, 'average_memory_mb': 10995.577918673638, 'sample_count': 665}, 'total_peak_memory_mb': 11820.8154296875}, 'system': {'peak_cpu_percent': 13.1, 'average_cpu_percent': 5.652702702702703, 'peak_memory_percent': 42.5, 'peak_memory_used_gb': 27.132843017578125, 'sample_count': 74}, 'monitoring_duration': 74.99531149864197}
2025-06-17 17:19:30,497 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745 的资源...
2025-06-17 17:19:30,925 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs4_rep1_20250617_171745 资源清理完成
2025-06-17 17:19:30,937 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs4_rep1
2025-06-17 17:19:31,044 - __main__ - INFO - Running FullKVCache: Rep 2/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 8
2025-06-17 17:19:31,189 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931
2025-06-17 17:19:31,260 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:19:31,261 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:19:31,261 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931
2025-06-17 17:19:31,261 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:19:31,261 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:19:31,339 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:19:31,339 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:19:31,339 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:19:34,329 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:19:34,329 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:19:34,329 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:19:34,545 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:19:34,545 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:19:34,545 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:19:34,546 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:19:34,546 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:19:34,546 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:19:34,546 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:19:34,546 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:19:34,714 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:19:34,714 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:19:37,224 - __main__ - INFO - Preparing batch with size 8, max_length 2048...
2025-06-17 17:19:37,231 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:19:37,231 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:20:20,222 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:20:20,222 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:20:20,222 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:20:20,223 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:20:20,223 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:21:00,717 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:22:40,375 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 140.15秒
2025-06-17 17:22:40,376 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:22:40,376 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:22:40,376 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9833.0MB, 最终峰值=13809.1MB
2025-06-17 17:22:40,426 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12120.4MB, 样本=1242
2025-06-17 17:22:40,426 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 17:22:40,426 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12120.4MB, 样本=1242
2025-06-17 17:22:40,426 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 17:22:40,427 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs8_rep1\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931.json
2025-06-17 17:22:40,427 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931', 'timestamp': '2025-06-17T17:22:40.426233', 'performance': {'success': True, 'ttft_ms': 40493.87335777283, 'tpot_ms': 2033.8074479784284, 'throughput_tokens_per_sec': 0.3567569610418538, 'total_time_sec': 140.15143489837646, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 1}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 13809.1279296875, 'average_memory_mb': 12120.37832872572, 'sample_count': 1242}, 'total_peak_memory_mb': 13809.1279296875}, 'system': {'peak_cpu_percent': 81.7, 'average_cpu_percent': 6.1869565217391305, 'peak_memory_percent': 44.3, 'peak_memory_used_gb': 28.287994384765625, 'sample_count': 138}, 'monitoring_duration': 140.20344924926758}
2025-06-17 17:22:40,427 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931 的资源...
2025-06-17 17:22:40,824 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs8_rep1_20250617_171931 资源清理完成
2025-06-17 17:22:40,828 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs8_rep1
2025-06-17 17:22:40,903 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 128, Batch: 1
2025-06-17 17:22:41,146 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241
2025-06-17 17:22:41,215 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:22:41,216 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:22:41,216 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241
2025-06-17 17:22:41,216 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:22:41,216 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:22:41,287 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:22:41,287 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:22:41,287 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:22:44,287 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:22:44,287 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:22:44,287 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:22:44,502 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:22:44,503 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:22:44,503 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 17:22:44,503 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:22:44,503 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 17:22:44,503 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:22:44,503 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:22:44,503 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:22:44,673 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:22:44,673 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:22:47,582 - __main__ - INFO - Preparing batch with size 1, max_length 128...
2025-06-17 17:22:47,586 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:22:47,586 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:22:57,436 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:22:57,436 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:22:57,437 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:22:57,437 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:22:57,438 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:22:59,248 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:24:03,683 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.25秒
2025-06-17 17:24:03,684 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:24:03,684 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:24:03,684 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10366.8MB
2025-06-17 17:24:03,720 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9967.3MB, 样本=587
2025-06-17 17:24:03,720 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 17:24:03,720 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10366.8MB, 平均=9967.3MB, 样本=587
2025-06-17 17:24:03,720 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10366.8MB
2025-06-17 17:24:03,721 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs1_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241.json
2025-06-17 17:24:03,721 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241', 'timestamp': '2025-06-17T17:24:03.720715', 'performance': {'success': True, 'ttft_ms': 1810.3225231170654, 'tpot_ms': 1314.9983931560905, 'throughput_tokens_per_sec': 0.7547711675752674, 'total_time_sec': 66.2452437877655, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10366.75341796875, 'average_memory_mb': 9967.316130915939, 'sample_count': 587}, 'total_peak_memory_mb': 10366.75341796875}, 'system': {'peak_cpu_percent': 14.4, 'average_cpu_percent': 5.398484848484849, 'peak_memory_percent': 44.1, 'peak_memory_used_gb': 28.152381896972656, 'sample_count': 66}, 'monitoring_duration': 66.2845208644867}
2025-06-17 17:24:03,721 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241 的资源...
2025-06-17 17:24:04,131 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs1_rep2_20250617_172241 资源清理完成
2025-06-17 17:24:04,143 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs1_rep2
2025-06-17 17:24:04,271 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 128, Batch: 4
2025-06-17 17:24:04,420 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404
2025-06-17 17:24:04,488 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:24:04,488 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:24:04,488 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404
2025-06-17 17:24:04,488 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:24:04,488 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:24:04,561 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:24:04,561 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:24:04,561 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:24:07,610 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:24:07,610 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:24:07,611 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:24:07,828 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:24:07,828 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:24:07,829 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 17:24:07,829 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:24:07,829 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 17:24:07,829 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:24:07,829 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:24:07,829 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:24:07,998 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:24:07,998 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:24:11,318 - __main__ - INFO - Preparing batch with size 4, max_length 128...
2025-06-17 17:24:11,321 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:24:11,321 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:24:24,010 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:24:24,010 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:24:24,010 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:24:24,010 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:24:24,011 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:24:27,983 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:25:32,174 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 68.16秒
2025-06-17 17:25:32,174 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:25:32,174 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:25:32,174 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10435.2MB
2025-06-17 17:25:32,326 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10024.9MB, 样本=605
2025-06-17 17:25:32,326 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 17:25:32,326 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10435.2MB, 平均=10024.9MB, 样本=605
2025-06-17 17:25:32,327 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10435.2MB
2025-06-17 17:25:32,327 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs4_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404.json
2025-06-17 17:25:32,328 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404', 'timestamp': '2025-06-17T17:25:32.326660', 'performance': {'success': True, 'ttft_ms': 3971.666097640991, 'tpot_ms': 1309.9979867740553, 'throughput_tokens_per_sec': 0.7335340715854208, 'total_time_sec': 68.16315960884094, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10435.15380859375, 'average_memory_mb': 10024.879248450414, 'sample_count': 605}, 'total_peak_memory_mb': 10435.15380859375}, 'system': {'peak_cpu_percent': 9.6, 'average_cpu_percent': 5.813235294117648, 'peak_memory_percent': 44.3, 'peak_memory_used_gb': 28.306930541992188, 'sample_count': 68}, 'monitoring_duration': 68.31622767448425}
2025-06-17 17:25:32,328 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404 的资源...
2025-06-17 17:25:32,708 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs4_rep2_20250617_172404 资源清理完成
2025-06-17 17:25:32,711 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs4_rep2
2025-06-17 17:25:32,786 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 128, Batch: 8
2025-06-17 17:25:32,931 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532
2025-06-17 17:25:33,004 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:25:33,004 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:25:33,004 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532
2025-06-17 17:25:33,004 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:25:33,004 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:25:33,075 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:25:33,075 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:25:33,075 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:25:36,116 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:25:36,116 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:25:36,116 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:25:36,338 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:25:36,338 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:25:36,338 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 128
2025-06-17 17:25:36,338 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:25:36,339 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 128
2025-06-17 17:25:36,339 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:25:36,339 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:25:36,339 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:25:36,508 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:25:36,509 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:25:40,084 - __main__ - INFO - Preparing batch with size 8, max_length 128...
2025-06-17 17:25:40,090 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:25:40,090 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:25:52,415 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:25:52,415 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:25:52,418 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:25:52,418 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:25:52,421 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:25:55,587 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:27:00,445 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 68.02秒
2025-06-17 17:27:00,446 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:27:00,446 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:27:00,446 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10530.5MB
2025-06-17 17:27:00,463 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10530.5MB, 平均=10094.3MB, 样本=603
2025-06-17 17:27:00,463 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10530.5MB
2025-06-17 17:27:00,463 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10530.5MB, 平均=10094.3MB, 样本=603
2025-06-17 17:27:00,463 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10530.5MB
2025-06-17 17:27:00,464 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv128_bs8_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532.json
2025-06-17 17:27:00,464 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532', 'timestamp': '2025-06-17T17:27:00.463036', 'performance': {'success': True, 'ttft_ms': 3166.2826538085938, 'tpot_ms': 1323.6141010206572, 'throughput_tokens_per_sec': 0.7350414622363209, 'total_time_sec': 68.0233736038208, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 128, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10530.48876953125, 'average_memory_mb': 10094.344120057265, 'sample_count': 603}, 'total_peak_memory_mb': 10530.48876953125}, 'system': {'peak_cpu_percent': 10.1, 'average_cpu_percent': 5.786567164179104, 'peak_memory_percent': 43.7, 'peak_memory_used_gb': 27.90640640258789, 'sample_count': 67}, 'monitoring_duration': 68.04732751846313}
2025-06-17 17:27:00,464 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532 的资源...
2025-06-17 17:27:00,850 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv128_bs8_rep2_20250617_172532 资源清理完成
2025-06-17 17:27:00,853 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv128_bs8_rep2
2025-06-17 17:27:00,930 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 256, Batch: 1
2025-06-17 17:27:01,083 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701
2025-06-17 17:27:01,157 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:27:01,158 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:27:01,158 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701
2025-06-17 17:27:01,158 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:27:01,158 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:27:01,230 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:27:01,230 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:27:01,230 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:27:04,287 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:27:04,287 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:27:04,287 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:27:04,509 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:27:04,509 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:27:04,509 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:27:04,509 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:27:04,509 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:27:04,509 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:27:04,509 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:27:04,509 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:27:04,680 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:27:04,680 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:27:07,491 - __main__ - INFO - Preparing batch with size 1, max_length 256...
2025-06-17 17:27:07,494 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:27:07,495 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:27:18,368 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:27:18,368 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:27:18,369 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:27:18,369 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:27:18,370 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:27:21,323 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:28:25,612 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.24秒
2025-06-17 17:28:25,612 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:28:25,612 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:28:25,613 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10382.8MB
2025-06-17 17:28:25,659 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9979.4MB, 样本=596
2025-06-17 17:28:25,659 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 17:28:25,659 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10382.8MB, 平均=9979.4MB, 样本=596
2025-06-17 17:28:25,659 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10382.8MB
2025-06-17 17:28:25,660 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs1_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701.json
2025-06-17 17:28:25,660 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701', 'timestamp': '2025-06-17T17:28:25.659142', 'performance': {'success': True, 'ttft_ms': 2952.800750732422, 'tpot_ms': 1312.002537201862, 'throughput_tokens_per_sec': 0.7435837433839583, 'total_time_sec': 67.24192190170288, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10382.75830078125, 'average_memory_mb': 9979.379534625366, 'sample_count': 596}, 'total_peak_memory_mb': 10382.75830078125}, 'system': {'peak_cpu_percent': 9.4, 'average_cpu_percent': 5.7567164179104475, 'peak_memory_percent': 44.6, 'peak_memory_used_gb': 28.471111297607422, 'sample_count': 67}, 'monitoring_duration': 67.2908091545105}
2025-06-17 17:28:25,660 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701 的资源...
2025-06-17 17:28:26,042 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs1_rep2_20250617_172701 资源清理完成
2025-06-17 17:28:26,046 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs1_rep2
2025-06-17 17:28:26,120 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 256, Batch: 4
2025-06-17 17:28:26,275 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826
2025-06-17 17:28:26,351 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:28:26,351 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:28:26,351 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826
2025-06-17 17:28:26,352 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:28:26,352 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:28:26,426 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:28:26,426 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:28:26,427 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:28:29,459 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:28:29,459 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:28:29,459 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:28:29,676 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:28:29,676 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:28:29,677 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:28:29,677 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:28:29,677 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:28:29,677 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:28:29,677 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:28:29,677 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:28:29,846 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:28:29,846 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:28:32,266 - __main__ - INFO - Preparing batch with size 4, max_length 256...
2025-06-17 17:28:32,268 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:28:32,268 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:28:44,762 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:28:44,762 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:28:44,763 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:28:44,763 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:28:44,765 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:28:47,646 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:29:51,797 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.03秒
2025-06-17 17:29:51,798 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:29:51,798 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:29:51,798 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10499.4MB
2025-06-17 17:29:51,843 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10083.0MB, 样本=595
2025-06-17 17:29:51,843 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 17:29:51,844 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10499.4MB, 平均=10083.0MB, 样本=595
2025-06-17 17:29:51,844 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10499.4MB
2025-06-17 17:29:51,845 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs4_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826.json
2025-06-17 17:29:51,845 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826', 'timestamp': '2025-06-17T17:29:51.844094', 'performance': {'success': True, 'ttft_ms': 2880.8631896972656, 'tpot_ms': 1309.2015081522418, 'throughput_tokens_per_sec': 0.745915325653822, 'total_time_sec': 67.0317370891571, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10499.43896484375, 'average_memory_mb': 10083.038814666492, 'sample_count': 595}, 'total_peak_memory_mb': 10499.43896484375}, 'system': {'peak_cpu_percent': 10.8, 'average_cpu_percent': 5.7, 'peak_memory_percent': 44.3, 'peak_memory_used_gb': 28.288402557373047, 'sample_count': 66}, 'monitoring_duration': 67.08119368553162}
2025-06-17 17:29:51,846 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826 的资源...
2025-06-17 17:29:52,235 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs4_rep2_20250617_172826 资源清理完成
2025-06-17 17:29:52,241 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs4_rep2
2025-06-17 17:29:52,317 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 256, Batch: 8
2025-06-17 17:29:52,469 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952
2025-06-17 17:29:52,546 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:29:52,546 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:29:52,546 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952
2025-06-17 17:29:52,546 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:29:52,546 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:29:52,622 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:29:52,622 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:29:52,622 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:29:55,697 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:29:55,698 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:29:55,698 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:29:55,929 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:29:55,929 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:29:55,929 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 256
2025-06-17 17:29:55,930 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:29:55,930 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 256
2025-06-17 17:29:55,930 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:29:55,930 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:29:55,930 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:29:56,245 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:29:56,282 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:30:00,895 - __main__ - INFO - Preparing batch with size 8, max_length 256...
2025-06-17 17:30:00,899 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:30:00,899 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:30:16,316 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:30:16,316 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:30:16,316 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:30:16,317 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:30:16,317 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:30:18,938 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:31:23,843 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.53秒
2025-06-17 17:31:23,843 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:31:23,843 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:31:23,843 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10658.1MB
2025-06-17 17:31:23,858 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10229.6MB, 样本=598
2025-06-17 17:31:23,858 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 17:31:23,858 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10658.1MB, 平均=10229.6MB, 样本=598
2025-06-17 17:31:23,858 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10658.1MB
2025-06-17 17:31:23,859 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv256_bs8_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952.json
2025-06-17 17:31:23,859 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952', 'timestamp': '2025-06-17T17:31:23.858795', 'performance': {'success': True, 'ttft_ms': 2620.868682861328, 'tpot_ms': 1324.5829076183086, 'throughput_tokens_per_sec': 0.7404508352147877, 'total_time_sec': 67.52642798423767, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 256, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10658.13720703125, 'average_memory_mb': 10229.638987053198, 'sample_count': 598}, 'total_peak_memory_mb': 10658.13720703125}, 'system': {'peak_cpu_percent': 95.3, 'average_cpu_percent': 7.168656716417911, 'peak_memory_percent': 42.7, 'peak_memory_used_gb': 27.258827209472656, 'sample_count': 67}, 'monitoring_duration': 67.5423743724823}
2025-06-17 17:31:23,859 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952 的资源...
2025-06-17 17:31:24,271 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv256_bs8_rep2_20250617_172952 资源清理完成
2025-06-17 17:31:24,287 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv256_bs8_rep2
2025-06-17 17:31:24,406 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 512, Batch: 1
2025-06-17 17:31:24,550 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124
2025-06-17 17:31:24,626 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:31:24,626 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:31:24,627 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124
2025-06-17 17:31:24,627 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:31:24,627 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:31:24,718 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:31:24,718 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:31:24,718 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:31:28,175 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:31:28,176 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:31:28,176 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:31:28,389 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:31:28,390 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:31:28,390 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:31:28,390 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:31:28,390 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:31:28,390 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:31:28,390 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:31:28,390 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:31:28,559 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:31:28,559 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:31:31,296 - __main__ - INFO - Preparing batch with size 1, max_length 512...
2025-06-17 17:31:31,299 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:31:31,299 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:31:43,852 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:31:43,852 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:31:43,852 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:31:43,853 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:31:43,853 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:31:45,606 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:32:50,626 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.77秒
2025-06-17 17:32:50,626 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:32:50,626 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:32:50,627 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10432.5MB
2025-06-17 17:32:50,648 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10034.3MB, 样本=592
2025-06-17 17:32:50,648 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 17:32:50,648 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10432.5MB, 平均=10034.3MB, 样本=592
2025-06-17 17:32:50,648 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10432.5MB
2025-06-17 17:32:50,649 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs1_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124.json
2025-06-17 17:32:50,649 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124', 'timestamp': '2025-06-17T17:32:50.648283', 'performance': {'success': True, 'ttft_ms': 1752.3770332336426, 'tpot_ms': 1326.919988710053, 'throughput_tokens_per_sec': 0.7488117964366169, 'total_time_sec': 66.77245235443115, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10432.52001953125, 'average_memory_mb': 10034.30764440588, 'sample_count': 592}, 'total_peak_memory_mb': 10432.52001953125}, 'system': {'peak_cpu_percent': 13.3, 'average_cpu_percent': 5.931818181818182, 'peak_memory_percent': 43.7, 'peak_memory_used_gb': 27.86422348022461, 'sample_count': 66}, 'monitoring_duration': 66.79558420181274}
2025-06-17 17:32:50,649 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124 的资源...
2025-06-17 17:32:51,050 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs1_rep2_20250617_173124 资源清理完成
2025-06-17 17:32:51,053 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs1_rep2
2025-06-17 17:32:51,126 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 512, Batch: 4
2025-06-17 17:32:51,278 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251
2025-06-17 17:32:51,351 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:32:51,351 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:32:51,352 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251
2025-06-17 17:32:51,352 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:32:51,352 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:32:51,424 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:32:51,424 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:32:51,425 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:32:54,493 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:32:54,493 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:32:54,493 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:32:54,710 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:32:54,711 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:32:54,711 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:32:54,711 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:32:54,711 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:32:54,711 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:32:54,711 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:32:54,711 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:32:54,882 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:32:54,882 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:32:57,776 - __main__ - INFO - Preparing batch with size 4, max_length 512...
2025-06-17 17:32:57,780 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:32:57,780 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:33:13,591 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:33:13,591 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:33:13,593 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:33:13,593 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:33:13,594 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:33:17,106 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:34:21,881 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 68.29秒
2025-06-17 17:34:21,881 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:34:21,881 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:34:21,881 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10633.1MB
2025-06-17 17:34:21,902 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10217.9MB, 样本=605
2025-06-17 17:34:21,902 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 17:34:21,902 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10633.1MB, 平均=10217.9MB, 样本=605
2025-06-17 17:34:21,902 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10633.1MB
2025-06-17 17:34:21,903 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs4_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251.json
2025-06-17 17:34:21,903 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251', 'timestamp': '2025-06-17T17:34:21.902672', 'performance': {'success': True, 'ttft_ms': 3512.5417709350586, 'tpot_ms': 1321.9070969795694, 'throughput_tokens_per_sec': 0.7322039358649947, 'total_time_sec': 68.2869861125946, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10633.11865234375, 'average_memory_mb': 10217.861397533574, 'sample_count': 605}, 'total_peak_memory_mb': 10633.11865234375}, 'system': {'peak_cpu_percent': 13.9, 'average_cpu_percent': 5.99264705882353, 'peak_memory_percent': 44.3, 'peak_memory_used_gb': 28.289649963378906, 'sample_count': 68}, 'monitoring_duration': 68.31149649620056}
2025-06-17 17:34:21,903 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251 的资源...
2025-06-17 17:34:22,281 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs4_rep2_20250617_173251 资源清理完成
2025-06-17 17:34:22,284 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs4_rep2
2025-06-17 17:34:22,366 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 512, Batch: 8
2025-06-17 17:34:22,513 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422
2025-06-17 17:34:22,660 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:34:22,661 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:34:22,661 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422
2025-06-17 17:34:22,661 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:34:22,662 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:34:22,758 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:34:22,758 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:34:22,758 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:34:25,765 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:34:25,765 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:34:25,765 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:34:25,994 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:34:25,995 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:34:25,995 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 512
2025-06-17 17:34:25,995 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:34:25,995 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 512
2025-06-17 17:34:25,995 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:34:25,995 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:34:25,995 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:34:26,166 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:34:26,166 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:34:28,523 - __main__ - INFO - Preparing batch with size 8, max_length 512...
2025-06-17 17:34:28,528 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:34:28,528 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:34:49,399 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:34:49,399 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:34:49,400 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:34:49,400 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:34:49,401 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:34:51,919 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:35:57,377 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.98秒
2025-06-17 17:35:57,378 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:35:57,378 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:35:57,378 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10909.5MB
2025-06-17 17:35:57,400 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10489.2MB, 样本=603
2025-06-17 17:35:57,400 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 17:35:57,400 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10909.5MB, 平均=10489.2MB, 样本=603
2025-06-17 17:35:57,400 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10909.5MB
2025-06-17 17:35:57,401 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv512_bs8_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422.json
2025-06-17 17:35:57,401 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422', 'timestamp': '2025-06-17T17:35:57.400835', 'performance': {'success': True, 'ttft_ms': 2518.3730125427246, 'tpot_ms': 1335.885831287929, 'throughput_tokens_per_sec': 0.7355452983008364, 'total_time_sec': 67.97677874565125, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 512, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10909.52783203125, 'average_memory_mb': 10489.15492200456, 'sample_count': 603}, 'total_peak_memory_mb': 10909.52783203125}, 'system': {'peak_cpu_percent': 14.1, 'average_cpu_percent': 6.628358208955223, 'peak_memory_percent': 42.3, 'peak_memory_used_gb': 27.02975845336914, 'sample_count': 67}, 'monitoring_duration': 68.00169610977173}
2025-06-17 17:35:57,401 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422 的资源...
2025-06-17 17:35:57,825 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs8_rep2_20250617_173422 资源清理完成
2025-06-17 17:35:57,828 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs8_rep2
2025-06-17 17:35:57,903 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 1
2025-06-17 17:35:58,055 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558
2025-06-17 17:35:58,129 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:35:58,130 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:35:58,130 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558
2025-06-17 17:35:58,130 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:35:58,130 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:35:58,204 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:35:58,205 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:35:58,205 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:36:01,214 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:36:01,214 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:36:01,214 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:36:01,430 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:36:01,430 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:36:01,431 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:36:01,431 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:36:01,431 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:36:01,431 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:36:01,431 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:36:01,431 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:36:01,612 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:36:01,613 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:36:04,381 - __main__ - INFO - Preparing batch with size 1, max_length 1024...
2025-06-17 17:36:04,383 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:36:04,384 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:36:16,954 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:36:16,954 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:36:16,955 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:36:16,955 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:36:16,957 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:36:18,891 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:37:23,200 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 66.24秒
2025-06-17 17:37:23,200 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:37:23,200 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:37:23,201 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10480.5MB
2025-06-17 17:37:23,254 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10074.6MB, 样本=587
2025-06-17 17:37:23,255 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 17:37:23,255 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10480.5MB, 平均=10074.6MB, 样本=587
2025-06-17 17:37:23,256 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10480.5MB
2025-06-17 17:37:23,257 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs1_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558.json
2025-06-17 17:37:23,258 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558', 'timestamp': '2025-06-17T17:37:23.255283', 'performance': {'success': True, 'ttft_ms': 1933.9616298675537, 'tpot_ms': 1312.4277056479941, 'throughput_tokens_per_sec': 0.7547976538299024, 'total_time_sec': 66.24291920661926, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10480.5341796875, 'average_memory_mb': 10074.644646041845, 'sample_count': 587}, 'total_peak_memory_mb': 10480.5341796875}, 'system': {'peak_cpu_percent': 11.4, 'average_cpu_percent': 5.606060606060606, 'peak_memory_percent': 44.1, 'peak_memory_used_gb': 28.15182113647461, 'sample_count': 66}, 'monitoring_duration': 66.30076026916504}
2025-06-17 17:37:23,258 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558 的资源...
2025-06-17 17:37:23,642 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs1_rep2_20250617_173558 资源清理完成
2025-06-17 17:37:23,646 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs1_rep2
2025-06-17 17:37:23,721 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 4
2025-06-17 17:37:23,870 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723
2025-06-17 17:37:24,019 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:37:24,020 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:37:24,020 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723
2025-06-17 17:37:24,020 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:37:24,021 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:37:24,111 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:37:24,111 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:37:24,111 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:37:27,550 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:37:27,550 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:37:27,550 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:37:27,769 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:37:27,769 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:37:27,769 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:37:27,770 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:37:27,770 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:37:27,770 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:37:27,770 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:37:27,770 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:37:27,938 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:37:27,939 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:37:30,439 - __main__ - INFO - Preparing batch with size 4, max_length 1024...
2025-06-17 17:37:30,443 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:37:30,443 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:37:52,636 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:37:52,636 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:37:52,636 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:37:52,637 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:37:52,637 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:37:55,247 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:39:01,783 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 69.14秒
2025-06-17 17:39:01,783 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:39:01,783 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:39:01,783 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.6MB, 最终峰值=10888.7MB
2025-06-17 17:39:01,826 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10475.8MB, 样本=614
2025-06-17 17:39:01,826 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 17:39:01,827 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10888.7MB, 平均=10475.8MB, 样本=614
2025-06-17 17:39:01,827 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10888.7MB
2025-06-17 17:39:01,828 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs4_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723.json
2025-06-17 17:39:01,828 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723', 'timestamp': '2025-06-17T17:39:01.827091', 'performance': {'success': True, 'ttft_ms': 2609.947681427002, 'tpot_ms': 1357.8496806475582, 'throughput_tokens_per_sec': 0.7231224563050099, 'total_time_sec': 69.14458203315735, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10888.6513671875, 'average_memory_mb': 10475.759452297943, 'sample_count': 614}, 'total_peak_memory_mb': 10888.6513671875}, 'system': {'peak_cpu_percent': 9.3, 'average_cpu_percent': 5.749999999999999, 'peak_memory_percent': 42.9, 'peak_memory_used_gb': 27.384952545166016, 'sample_count': 68}, 'monitoring_duration': 69.19035315513611}
2025-06-17 17:39:01,828 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723 的资源...
2025-06-17 17:39:02,247 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs4_rep2_20250617_173723 资源清理完成
2025-06-17 17:39:02,259 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs4_rep2
2025-06-17 17:39:02,363 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 1024, Batch: 8
2025-06-17 17:39:02,511 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902
2025-06-17 17:39:02,586 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:39:02,587 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:39:02,587 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902
2025-06-17 17:39:02,587 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:39:02,587 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:39:02,659 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:39:02,660 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:39:02,660 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:39:05,683 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:39:05,683 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:39:05,683 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:39:05,910 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:39:05,910 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:39:05,910 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 1024
2025-06-17 17:39:05,910 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:39:05,911 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 1024
2025-06-17 17:39:05,911 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:39:05,911 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:39:05,911 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:39:06,080 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:39:06,080 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:39:08,908 - __main__ - INFO - Preparing batch with size 8, max_length 1024...
2025-06-17 17:39:08,913 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:39:08,913 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:39:33,631 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:39:33,631 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:39:33,633 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:39:33,633 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:39:33,635 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:39:41,130 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:40:48,373 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 74.74秒
2025-06-17 17:40:48,373 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:40:48,373 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:40:48,374 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11804.8MB
2025-06-17 17:40:48,422 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11002.0MB, 样本=663
2025-06-17 17:40:48,422 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 17:40:48,422 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11804.8MB, 平均=11002.0MB, 样本=663
2025-06-17 17:40:48,422 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11804.8MB
2025-06-17 17:40:48,423 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv1024_bs8_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902.json
2025-06-17 17:40:48,423 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902', 'timestamp': '2025-06-17T17:40:48.422982', 'performance': {'success': True, 'ttft_ms': 7494.826555252075, 'tpot_ms': 1372.278826577323, 'throughput_tokens_per_sec': 0.6690083110234808, 'total_time_sec': 74.73748707771301, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 1024, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11804.8076171875, 'average_memory_mb': 11002.007565045249, 'sample_count': 663}, 'total_peak_memory_mb': 11804.8076171875}, 'system': {'peak_cpu_percent': 13.2, 'average_cpu_percent': 5.68108108108108, 'peak_memory_percent': 46.0, 'peak_memory_used_gb': 29.348834991455078, 'sample_count': 74}, 'monitoring_duration': 74.79133558273315}
2025-06-17 17:40:48,423 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902 的资源...
2025-06-17 17:40:48,829 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv1024_bs8_rep2_20250617_173902 资源清理完成
2025-06-17 17:40:48,832 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv1024_bs8_rep2
2025-06-17 17:40:48,907 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 1
2025-06-17 17:40:49,056 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049
2025-06-17 17:40:49,138 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:40:49,138 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:40:49,138 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049
2025-06-17 17:40:49,138 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:40:49,138 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:40:49,213 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:40:49,213 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:40:49,213 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:40:52,148 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:40:52,149 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:40:52,149 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:40:52,363 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:40:52,364 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:40:52,364 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:40:52,364 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:40:52,364 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:40:52,364 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:40:52,364 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:40:52,364 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:40:52,532 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:40:52,532 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:40:55,387 - __main__ - INFO - Preparing batch with size 1, max_length 2048...
2025-06-17 17:40:55,389 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:40:55,389 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:41:11,349 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:41:11,350 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:41:11,352 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:41:11,352 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:41:11,355 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:41:13,686 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:42:18,982 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 67.63秒
2025-06-17 17:42:18,982 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:42:18,982 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:42:18,983 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.5MB, 最终峰值=10616.6MB
2025-06-17 17:42:19,023 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.3MB, 样本=597
2025-06-17 17:42:19,023 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 17:42:19,023 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=10616.6MB, 平均=10205.3MB, 样本=597
2025-06-17 17:42:19,023 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 10616.6MB
2025-06-17 17:42:19,024 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs1_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049.json
2025-06-17 17:42:19,024 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049', 'timestamp': '2025-06-17T17:42:19.023298', 'performance': {'success': True, 'ttft_ms': 2330.970048904419, 'tpot_ms': 1332.5850428367148, 'throughput_tokens_per_sec': 0.7393427023133852, 'total_time_sec': 67.62763714790344, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 1, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 10616.5810546875, 'average_memory_mb': 10205.329842572237, 'sample_count': 597}, 'total_peak_memory_mb': 10616.5810546875}, 'system': {'peak_cpu_percent': 96.2, 'average_cpu_percent': 7.401492537313432, 'peak_memory_percent': 43.8, 'peak_memory_used_gb': 27.971763610839844, 'sample_count': 67}, 'monitoring_duration': 67.67320704460144}
2025-06-17 17:42:19,024 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049 的资源...
2025-06-17 17:42:19,442 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs1_rep2_20250617_174049 资源清理完成
2025-06-17 17:42:19,466 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs1_rep2
2025-06-17 17:42:19,565 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 4
2025-06-17 17:42:19,711 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219
2025-06-17 17:42:19,785 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:42:19,785 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:42:19,785 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219
2025-06-17 17:42:19,785 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:42:19,785 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:42:19,860 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:42:19,860 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:42:19,860 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:42:22,883 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:42:22,884 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:42:22,884 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:42:23,104 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:42:23,104 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:42:23,104 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:42:23,104 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:42:23,104 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:42:23,104 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:42:23,104 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:42:23,104 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:42:23,285 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:42:23,285 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:42:25,777 - __main__ - INFO - Preparing batch with size 4, max_length 2048...
2025-06-17 17:42:25,782 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:42:25,782 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:42:49,953 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:42:49,953 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:42:49,954 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:42:49,954 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:42:49,955 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:42:57,752 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:44:04,697 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 74.74秒
2025-06-17 17:44:04,697 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:44:04,697 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:44:04,698 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9832.7MB, 最终峰值=11820.8MB
2025-06-17 17:44:04,747 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10992.9MB, 样本=663
2025-06-17 17:44:04,748 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 17:44:04,748 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=11820.8MB, 平均=10992.9MB, 样本=663
2025-06-17 17:44:04,749 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 11820.8MB
2025-06-17 17:44:04,750 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs4_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219.json
2025-06-17 17:44:04,751 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219', 'timestamp': '2025-06-17T17:44:04.748375', 'performance': {'success': True, 'ttft_ms': 7797.636985778809, 'tpot_ms': 1366.2054052158278, 'throughput_tokens_per_sec': 0.6689616630132162, 'total_time_sec': 74.7426986694336, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 4, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 11820.8154296875, 'average_memory_mb': 10992.87009656627, 'sample_count': 663}, 'total_peak_memory_mb': 11820.8154296875}, 'system': {'peak_cpu_percent': 14.9, 'average_cpu_percent': 5.937837837837837, 'peak_memory_percent': 42.1, 'peak_memory_used_gb': 26.8712158203125, 'sample_count': 74}, 'monitoring_duration': 74.7953691482544}
2025-06-17 17:44:04,751 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219 的资源...
2025-06-17 17:44:05,170 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs4_rep2_20250617_174219 资源清理完成
2025-06-17 17:44:05,174 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs4_rep2
2025-06-17 17:44:05,249 - __main__ - INFO - Running FullKVCache: Rep 3/3, Dataset: hotpotqa, KV_Len: 2048, Batch: 8
2025-06-17 17:44:05,401 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405
2025-06-17 17:44:05,572 - __main__ - INFO - 实验前内存清理完成
2025-06-17 17:44:05,572 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-17 17:44:05,572 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405
2025-06-17 17:44:05,572 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-17 17:44:05,572 - __main__ - INFO - Loading model and tokenizer...
2025-06-17 17:44:05,645 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-17 17:44:05,645 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-17 17:44:05,645 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-17 17:44:08,658 - accelerate.big_modeling - WARNING - Some parameters are on the meta device because they were offloaded to the disk.
2025-06-17 17:44:08,658 - hace_core.models.model_loader - INFO - Model loaded successfully with dtype: torch.float16
2025-06-17 17:44:08,659 - hace_core.models.model_loader - INFO - GPU 0 显存使用: 已分配 9.60GB, 已保留 9.71GB
2025-06-17 17:44:08,877 - hace_core.models.model_loader - INFO - Tokenizer loaded successfully
2025-06-17 17:44:08,877 - __main__ - INFO - 模型加载后GPU内存: 10.31GB
2025-06-17 17:44:08,877 - hace_core.models.model_loader - INFO - Configuring model for KV cache length: 2048
2025-06-17 17:44:08,877 - hace_core.models.model_loader - INFO - Updated max_position_embeddings from 32768 to 32768
2025-06-17 17:44:08,877 - hace_core.models.model_loader - INFO - Model mistral configured successfully for KV cache length: 2048
2025-06-17 17:44:08,877 - hace_core.models.model_loader - INFO - Preparing model for baseline testing with default KV cache
2025-06-17 17:44:08,877 - __main__ - INFO - Loading dataset hotpotqa...
2025-06-17 17:44:08,877 - __main__ - INFO - 尝试从本地JSONL文件加载数据集: hotpotqa
2025-06-17 17:44:09,047 - __main__ - INFO - ✅ 从本地加载 hotpotqa，共 7405 条样本
2025-06-17 17:44:09,047 - __main__ - INFO - ✅ 成功从本地JSONL文件加载 hotpotqa (来源: local)
2025-06-17 17:44:11,780 - __main__ - INFO - Preparing batch with size 8, max_length 2048...
2025-06-17 17:44:11,790 - __main__ - INFO - 输入数据验证通过
2025-06-17 17:44:11,790 - __main__ - INFO - Warming up FullKVCache model...
2025-06-17 17:44:54,501 - hace_core.utils.unified_monitor - INFO - 启动统一监控
2025-06-17 17:44:54,501 - hace_core.utils.unified_monitor - INFO - GPU 0 峰值内存统计已重置
2025-06-17 17:44:54,502 - hace_core.utils.unified_monitor - INFO - 统一监控循环已启动
2025-06-17 17:44:54,502 - __main__ - INFO - Starting FullKVCache performance measurement...
2025-06-17 17:44:54,504 - hace_core.utils.unified_monitor - INFO - 开始生成计时
2025-06-17 17:45:32,497 - hace_core.utils.unified_monitor - INFO - 记录第一个令牌生成
2025-06-17 17:47:09,887 - hace_core.utils.unified_monitor - INFO - 结束生成计时，总时间: 135.38秒
2025-06-17 17:47:09,887 - __main__ - INFO - 评分模块不可用，跳过自动评分
2025-06-17 17:47:09,887 - hace_core.utils.unified_monitor - INFO - 停止统一监控
2025-06-17 17:47:09,888 - hace_core.utils.unified_monitor - INFO - GPU 0 最终内存状态: 当前分配=9833.0MB, 最终峰值=13809.1MB
2025-06-17 17:47:09,903 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12101.9MB, 样本=1198
2025-06-17 17:47:09,903 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 17:47:09,903 - hace_core.utils.unified_monitor - INFO - 设备 0 统计: 峰值=13809.1MB, 平均=12101.9MB, 样本=1198
2025-06-17 17:47:09,903 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 13809.1MB
2025-06-17 17:47:09,904 - hace_core.utils.unified_monitor - INFO - 统一监控指标已保存到: results\fullkvcache_experiments\fullkvcache_run_20250617_163301\ds_hotpotqa_kv2048_bs8_rep2\fullkvcache_metrics_fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405.json
2025-06-17 17:47:09,904 - __main__ - INFO - FullKVCache Experiment fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405 completed. Metrics: {'experiment_id': 'fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405', 'timestamp': '2025-06-17T17:47:09.903938', 'performance': {'success': True, 'ttft_ms': 37993.5998916626, 'tpot_ms': 1987.5372331969593, 'throughput_tokens_per_sec': 0.36932007630349956, 'total_time_sec': 135.38392090797424, 'tokens_generated': 50, 'model_name': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'batch_size': 8, 'kv_cache_length': 2048, 'max_new_tokens': 50, 'use_fullkvcache': True, 'dataset': 'hotpotqa', 'repetition': 2}, 'gpu': {'total_devices': 1, 'device_0': {'peak_memory_mb': 13809.1279296875, 'average_memory_mb': 12101.892746863261, 'sample_count': 1198}, 'total_peak_memory_mb': 13809.1279296875}, 'system': {'peak_cpu_percent': 100.0, 'average_cpu_percent': 6.694776119402986, 'peak_memory_percent': 44.4, 'peak_memory_used_gb': 28.340316772460938, 'sample_count': 134}, 'monitoring_duration': 135.4028582572937}
2025-06-17 17:47:09,904 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405 的资源...
2025-06-17 17:47:10,305 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv2048_bs8_rep2_20250617_174405 资源清理完成
2025-06-17 17:47:10,309 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv2048_bs8_rep2
2025-06-17 17:47:10,387 - __main__ - INFO - All FullKVCache experiment summaries saved to results\fullkvcache_experiments\fullkvcache_run_20250617_163301\all_fullkvcache_experiments_summary.csv
2025-06-17 17:47:10,387 - __main__ - INFO - 开始处理基线评分...
2025-06-17 17:47:10,387 - __main__ - WARNING - 未找到有效的评分结果，无法建立基线
2025-06-17 17:47:10,387 - __main__ - INFO - FullKVCache experiment suite finished.
