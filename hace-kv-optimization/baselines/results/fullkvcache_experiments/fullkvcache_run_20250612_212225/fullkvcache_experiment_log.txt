2025-06-12 21:22:25,687 - __main__ - INFO - Starting FullKVCache experiment suite with run name: fullkvcache_run_20250612_212225
2025-06-12 21:22:25,687 - __main__ - INFO - Arguments: Namespace(model_name='C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', datasets='hotpotqa', kv_cache_lengths='512', batch_sizes='1', max_new_tokens=10, repetitions=1, output_dir='results\\fullkvcache_experiments', log_level='INFO', seed=42, run_name='fullkvcache_run_20250612_212225', enable_scoring=True, is_baseline_run=True)
2025-06-12 21:22:25,688 - __main__ - INFO - Global EXPERIMENT_CONFIG being used: {'model_name_or_path': 'C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3', 'precision': 'fp16', 'multi_model_experiments': True, 'experiment_models': ['NousResearch/Llama-2-7b-hf', 'meta-llama/Meta-Llama-3.1-8B-Instruct', 'mistralai/Mistral-7B-Instruct-v0.3'], 'memory_management': {'auto_max_memory': True, 'manual_max_memory': {0: '23000MB'}, 'memory_buffer_ratio': 0.05, 'force_no_cpu_offload': True}, 'datasets': ['mmlu', 'gsm8k', 'winogrande', 'arc_challenge', 'hellaswag', 'truthful_qa_mc'], 'dataset_subset_size': {'mmlu': 100, 'gsm8k': 100, 'winogrande': None, 'arc_challenge': None, 'hellaswag': None, 'truthful_qa_mc': None, 'pubmed_qa': 100, 'cais/mmlu-zh': 50}, 'kv_cache_lengths': [128, 256, 512, 1024, 2048], 'batch_sizes': [1, 4, 8], 'max_new_tokens': 256, 'repetitions': 3, 'h2o_enabled': True, 'h2o_ratios': [0.1, 0.2, 0.3], 'eviction_strategies': ['attention', 'time_decay', 'hybrid'], 'h2o_kv_cache_lengths': [128, 256, 512, 1024, 2048], 'cake_enabled': True, 'layer_allocation_strategies': ['uniform', 'adaptive', 'attention_based'], 'layer_analysis_configs': {'attention_pattern_analysis': True, 'layer_importance_scoring': True, 'dynamic_allocation': True}, 'cache_budgets': [0.5, 0.7, 0.9], 'cake_kv_cache_lengths': [128, 256, 512, 1024, 2048], 'head_level_optimization': False, 'head_analysis_enabled': False, 'head_selection_strategy': 'top_k', 'head_k_value': 10, 'output_base_dir': 'results', 'enable_monitoring': True, 'monitor_interval': 0.5}
2025-06-12 21:22:25,707 - __main__ - INFO - Random seed set to 42
2025-06-12 21:22:25,707 - __main__ - INFO - Total number of FullKVCache experiment configurations to run: 1
2025-06-12 21:22:25,709 - __main__ - INFO - Running FullKVCache: Rep 1/1, Dataset: hotpotqa, KV_Len: 512, Batch: 1
2025-06-12 21:22:25,832 - __main__ - INFO - Starting FullKVCache experiment: fullkvcache_hotpotqa_kv512_bs1_rep0_20250612_212225
2025-06-12 21:22:25,877 - __main__ - INFO - 实验前内存清理完成
2025-06-12 21:22:25,878 - hace_core.utils.unified_monitor - INFO - 发现1个GPU设备
2025-06-12 21:22:25,878 - hace_core.utils.unified_monitor - INFO - 统一监控器初始化完成，实验ID: fullkvcache_hotpotqa_kv512_bs1_rep0_20250612_212225
2025-06-12 21:22:25,878 - hace_core.utils.unified_monitor - INFO - 记录实验配置
2025-06-12 21:22:25,878 - __main__ - INFO - Loading model and tokenizer...
2025-06-12 21:22:25,878 - hace_core.models.model_loader - INFO - Loading model: C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3
2025-06-12 21:22:25,878 - hace_core.models.model_loader - INFO - GPU 0: 总显存 12281MB, 自动设置上限 11000MB (缓冲比例: 5.0%)
2025-06-12 21:22:25,879 - hace_core.models.model_loader - INFO - 使用精细显存控制: {0: '11000MB'}
2025-06-12 21:22:30,315 - hace_core.models.model_loader - ERROR - Error loading model: Error no file named pytorch_model.bin, model.safetensors, tf_model.h5, model.ckpt.index or flax_model.msgpack found in directory C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3.
2025-06-12 21:22:30,316 - __main__ - ERROR - Error during FullKVCache experiment fullkvcache_hotpotqa_kv512_bs1_rep0_20250612_212225: Error no file named pytorch_model.bin, model.safetensors, tf_model.h5, model.ckpt.index or flax_model.msgpack found in directory C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3.
Traceback (most recent call last):
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\baselines\fullkvcache_main.py", line 491, in run_fullkvcache_experiment
    model, tokenizer = load_model_and_tokenizer(model_config)
  File "C:\Users\JerryGanst\PycharmProjects\Experiment-Platform\hace-kv-optimization\hace_core\models\model_loader.py", line 82, in load_model_and_tokenizer
    model = AutoModelForCausalLM.from_pretrained(
  File "C:\Users\JerryGanst\anaconda3\envs\h2o-env\lib\site-packages\transformers\models\auto\auto_factory.py", line 571, in from_pretrained
    return model_class.from_pretrained(
  File "C:\Users\JerryGanst\anaconda3\envs\h2o-env\lib\site-packages\transformers\modeling_utils.py", line 279, in _wrapper
    return func(*args, **kwargs)
  File "C:\Users\JerryGanst\anaconda3\envs\h2o-env\lib\site-packages\transformers\modeling_utils.py", line 4260, in from_pretrained
    checkpoint_files, sharded_metadata = _get_resolved_checkpoint_files(
  File "C:\Users\JerryGanst\anaconda3\envs\h2o-env\lib\site-packages\transformers\modeling_utils.py", line 952, in _get_resolved_checkpoint_files
    raise EnvironmentError(
OSError: Error no file named pytorch_model.bin, model.safetensors, tf_model.h5, model.ckpt.index or flax_model.msgpack found in directory C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3.
2025-06-12 21:22:30,317 - hace_core.utils.unified_monitor - ERROR - 实验标记为失败: Error no file named pytorch_model.bin, model.safetensors, tf_model.h5, model.ckpt.index or flax_model.msgpack found in directory C:/Users/JerryGanst/mistral_models/7B-Instruct-v0.3.
2025-06-12 21:22:30,317 - hace_core.utils.unified_monitor - WARNING - 设备 0 没有收集到GPU内存数据
2025-06-12 21:22:30,317 - hace_core.utils.unified_monitor - INFO - GPU统计摘要: 总峰值内存 0.0MB
2025-06-12 21:22:30,317 - __main__ - INFO - 开始清理实验 fullkvcache_hotpotqa_kv512_bs1_rep0_20250612_212225 的资源...
2025-06-12 21:22:30,435 - __main__ - INFO - 实验 fullkvcache_hotpotqa_kv512_bs1_rep0_20250612_212225 资源清理完成
2025-06-12 21:22:30,436 - __main__ - INFO - ✓ 实验成功完成: ds_hotpotqa_kv512_bs1_rep0
2025-06-12 21:22:30,552 - __main__ - INFO - All FullKVCache experiment summaries saved to results\fullkvcache_experiments\fullkvcache_run_20250612_212225\all_fullkvcache_experiments_summary.csv
2025-06-12 21:22:30,552 - __main__ - INFO - 开始处理基线评分...
2025-06-12 21:22:30,552 - __main__ - WARNING - 未找到有效的评分结果，无法建立基线
2025-06-12 21:22:30,553 - __main__ - INFO - FullKVCache experiment suite finished.
